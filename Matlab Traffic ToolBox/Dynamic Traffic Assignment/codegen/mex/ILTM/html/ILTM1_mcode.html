<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T44U3">cvn_up</span>,<span class="var type1" id="S3T44U4">cvn_down</span>,<span class="var type1" id="S4T38U5">con_up</span>,<span class="var type1" id="S5T38U6">con_down</span>] = ILTM(<span class="var type1" id="S6T4U9">node_prop</span>,<span class="var type1" id="S7T1U10">links</span>,<span class="var type1" id="S8T5U11">origins</span>,<span class="var type1" id="S9T5U12">destinations</span>,<span class="var type1" id="S10T44U13">ODmatrix</span>,<span class="var type1" id="S11T3U14">dt</span>,<span class="var type1" id="S12T3U15">totT</span>,<span class="var type1" id="S13T44U16">TF</span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line">    ,<span class="var type1" id="S14T6U17">varargin</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%intelligent link transmission assignment procedure                       %</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%                                                                         %</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%iterative updating of grid points                                        %</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%intelligent activation/deactivations of grid points                      %</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%destination based storing of commodities                                 %</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%splitting rates at nodes based on TF                                     %</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%make data link and data node work</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="mxinfo" id="T3:U14"><span class="var type1" id="S15T3U20">totLinks</span>=<span class="mxinfo" id="T3:U16">length(<span class="mxinfo" id="T2:U17"><span class="var type1" id="S7T1U24">links</span>.id</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="mxinfo" id="T3:U19"><span class="var type1" id="S17T3U28">totNodes</span>=<span class="mxinfo" id="T3:U21">length(<span class="mxinfo" id="T2:U22"><span class="var type1" id="S6T4U32">node_prop</span>.nbIncomingLinks</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="mxinfo" id="T3:U24"><span class="var type1" id="S18T3U36">totDestinations</span>=<span class="mxinfo" id="T3:U26">length(<span class="var type1" id="S9T5U39">destinations</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%local rename link properties</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo" id="T2:U28"><span class="var type1" id="S19T2U42">strN</span> = <span class="mxinfo" id="T2:U30"><span class="var type1" id="S7T1U44">links</span>.fromNode</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="mxinfo" id="T2:U32"><span class="var type1" id="S20T2U48">endN</span> = <span class="mxinfo" id="T2:U34"><span class="var type1" id="S7T1U50">links</span>.toNode</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="mxinfo" id="T2:U36"><span class="var type1" id="S21T2U54">len</span> = <span class="mxinfo" id="T2:U38"><span class="var type1" id="S7T1U56">links</span>.length</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo" id="T2:U40"><span class="var type1" id="S22T2U60">cap</span> = <span class="mxinfo" id="T2:U42"><span class="var type1" id="S7T1U62">links</span>.capacity</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo" id="T2:U44"><span class="var type1" id="S23T2U66">kJm</span> = <span class="mxinfo" id="T2:U46"><span class="var type1" id="S7T1U68">links</span>.kJam</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo" id="T2:U48"><span class="var type1" id="S24T2U72">vind</span>=<span class="mxinfo" id="T2:U50"><span class="var type1" id="S7T1U74">links</span>.vf_index</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo" id="T2:U52"><span class="var type1" id="S25T2U78">vRt</span>=<span class="mxinfo" id="T2:U54"><span class="var type1" id="S7T1U80">links</span>.vf_ratio</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo" id="T2:U56"><span class="var type1" id="S26T2U84">wind</span>=<span class="mxinfo" id="T2:U58"><span class="var type1" id="S7T1U86">links</span>.vw_index</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo" id="T2:U60"><span class="var type1" id="S27T2U90">wRt</span>=<span class="mxinfo" id="T2:U62"><span class="var type1" id="S7T1U92">links</span>.vw_ratio</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%local rename node properties</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo" id="T2:U64"><span class="var type1" id="S28T2U96">inL</span> = <span class="mxinfo" id="T2:U66"><span class="var type1" id="S6T4U98">node_prop</span>.incomingLinksList</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo" id="T2:U68"><span class="var type1" id="S29T2U102">outL</span> = <span class="mxinfo" id="T2:U70"><span class="var type1" id="S6T4U104">node_prop</span>.outgoingLinksList</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo" id="T2:U72"><span class="var type1" id="S30T2U108">nin</span> = <span class="mxinfo" id="T2:U74"><span class="var type1" id="S6T4U110">node_prop</span>.nbIncomingLinks</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo" id="T2:U76"><span class="var type1" id="S31T2U114">nout</span> = <span class="mxinfo" id="T2:U78"><span class="var type1" id="S6T4U116">node_prop</span>.nbOutgoingLinks</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo" id="T2:U80"><span class="var type1" id="S32T2U120">posIn</span> = <span class="mxinfo" id="T2:U82"><span class="var type1" id="S6T4U122">node_prop</span>.positionFirstIn</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo" id="T2:U84"><span class="var type1" id="S33T2U126">posOut</span> = <span class="mxinfo" id="T2:U86"><span class="var type1" id="S6T4U128">node_prop</span>.positionFirstOut</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo" id="T2:U88"><span class="var type1" id="S34T2U132">nTF</span> = <span class="mxinfo" id="T2:U90"><span class="var type1" id="S6T4U134">node_prop</span>.nbTF</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo" id="T2:U92"><span class="var type1" id="S35T2U138">inTF_index</span> = <span class="mxinfo" id="T2:U94"><span class="var type1" id="S6T4U140">node_prop</span>.incomingLinksTFindex</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo" id="T2:U96"><span class="var type1" id="S36T2U144">outTF_index</span> = <span class="mxinfo" id="T2:U98"><span class="var type1" id="S6T4U146">node_prop</span>.outgoingLinksTFindex</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo" id="T2:U100"><span class="var type1" id="S37T2U150">posTF</span> = <span class="mxinfo" id="T2:U102"><span class="var type1" id="S6T4U152">node_prop</span>.positionFirstTF</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="keyword">if</span> nargin==8</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">    <span class="var type0" id="S2T0U162">cvn_up</span> = zeros(<span class="var type0" id="S15T0U165">totLinks</span>,<span class="var type0" id="S18T0U166">totDestinations</span>,<span class="var type0" id="S12T0U168">totT</span>+1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">    <span class="var type0" id="S3T0U172">cvn_down</span> = zeros(<span class="var type0" id="S15T0U175">totLinks</span>,<span class="var type0" id="S18T0U176">totDestinations</span>,<span class="var type0" id="S12T0U178">totT</span>+1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">    <span class="var type0" id="S4T0U182">con_up</span> = false(<span class="var type0" id="S15T0U185">totLinks</span>,<span class="var type0" id="S12T0U187">totT</span>+1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">    <span class="var type0" id="S5T0U191">con_down</span> = false(<span class="var type0" id="S15T0U194">totLinks</span>,<span class="var type0" id="S12T0U196">totT</span>+1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">    <span class="var type0" id="S41T0U200">nodes2update</span> = false(<span class="var type0" id="S17T0U203">totNodes</span>,<span class="var type0" id="S12T0U205">totT</span>+1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line">    <span class="var type0" id="S41T0U210">nodes2update</span>(<span class="var type0" id="S8T0U211">origins</span>,:) = true;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">    <span class="var type0" id="S43T0U217">max_it_ILTM</span> = 5000;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">    <span class="var type0" id="S44T0U221">marg_comp</span> = false;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">    <span class="var type0" id="S45T0U226">precDNL</span> = 10^-8;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="keyword">elseif</span> nargin==13</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">    <span class="mxinfo" id="T44:U104"><span class="var type1" id="S2T44U238">cvn_up</span> = <span class="mxinfo" id="T44:U106"><span class="var type1" id="S14T6U240">varargin</span>{1}</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">    <span class="mxinfo" id="T44:U108"><span class="var type1" id="S3T44U244">cvn_down</span> = <span class="mxinfo" id="T44:U110"><span class="var type1" id="S14T6U246">varargin</span>{2}</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">    <span class="mxinfo" id="T38:U112"><span class="var type1" id="S4T38U250">con_up</span> = <span class="mxinfo" id="T38:U114"><span class="var type1" id="S14T6U252">varargin</span>{3}</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">    <span class="mxinfo" id="T38:U116"><span class="var type1" id="S5T38U256">con_down</span> = <span class="mxinfo" id="T38:U118"><span class="var type1" id="S14T6U258">varargin</span>{4}</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">    <span class="mxinfo" id="T38:U120"><span class="var type1" id="S41T38U262">nodes2update</span> = <span class="mxinfo" id="T38:U122"><span class="var type1" id="S14T6U264">varargin</span>{5}</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line">    <span class="mxinfo" id="T3:U124"><span class="var type1" id="S43T3U268">max_it_ILTM</span> = <span class="mxinfo" id="T3:U126">5000</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">    <span class="mxinfo" id="T7:U127"><span class="var type1" id="S44T7U272">marg_comp</span> = <span class="mxinfo" id="T7:U129">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">    <span class="mxinfo" id="T3:U130"><span class="var type1" id="S45T3U277">precDNL</span> = <span class="mxinfo" id="T3:U132"><span class="mxinfo" id="T3:U133">10</span>^-8</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="keyword">elseif</span> nargin==15</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line">    <span class="var type0" id="S2T0U289">cvn_up</span> = <span class="var type0" id="S14T0U291">varargin</span>{1};</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">    <span class="var type0" id="S3T0U295">cvn_down</span> = <span class="var type0" id="S14T0U297">varargin</span>{2};</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line">    <span class="var type0" id="S4T0U301">con_up</span> = <span class="var type0" id="S14T0U303">varargin</span>{3};</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">    <span class="var type0" id="S5T0U307">con_down</span> = <span class="var type0" id="S14T0U309">varargin</span>{4};</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line">    <span class="var type0" id="S41T0U313">nodes2update</span> = <span class="var type0" id="S14T0U315">varargin</span>{5};</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line">    <span class="var type0" id="S43T0U319">max_it_ILTM</span> = <span class="var type0" id="S14T0U321">varargin</span>{6};</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line">    <span class="var type0" id="S45T0U325">precDNL</span> = <span class="var type0" id="S14T0U327">varargin</span>{7};</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">    <span class="var type0" id="S44T0U331">marg_comp</span> = true;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line">    display(<span class="string">'problem with number of inputs'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%max size of network</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%(can be set dynamically as well need to check for speed)s</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%(good practice to fix vector sizes on beforehand)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo" id="T3:U134"><span class="var type1" id="S47T3U342">maxIncomingLinks</span> = <span class="mxinfo" id="T3:U136">max(<span class="var type1" id="S30T2U345">nin</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="mxinfo" id="T3:U138"><span class="var type1" id="S49T3U348">maxOutgoingLinks</span> = <span class="mxinfo" id="T3:U140">max(<span class="var type1" id="S31T2U351">nout</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%allocate memory to all local variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="mxinfo" id="T2:U142"><span class="var type1" id="S50T2U354">RF_down_cvn_db</span> = <span class="mxinfo" id="T2:U144">zeros(<span class="var type1" id="S15T3U357">totLinks</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="mxinfo" id="T45:U146"><span class="var type1" id="S51T45U361">SF_up_cvn_db</span> = <span class="mxinfo" id="T45:U148">zeros(<span class="var type1" id="S15T3U364">totLinks</span>,<span class="var type1" id="S18T3U365">totDestinations</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="mxinfo" id="T2:U151"><span class="var type1" id="S52T2U368">incomingLinks</span> = <span class="mxinfo" id="T2:U153">zeros(<span class="var type1" id="S47T3U371">maxIncomingLinks</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="mxinfo" id="T2:U155"><span class="var type1" id="S53T2U375">outgoingLinks</span> = <span class="mxinfo" id="T2:U157">zeros(<span class="var type1" id="S49T3U378">maxOutgoingLinks</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="mxinfo" id="T2:U159"><span class="var type1" id="S54T2U382">tot_sendingFlow</span> = <span class="mxinfo" id="T2:U161">zeros(<span class="var type1" id="S47T3U385">maxIncomingLinks</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"><span class="mxinfo" id="T2:U163"><span class="var type1" id="S55T2U389">temp_capacities</span> = <span class="mxinfo" id="T2:U165">zeros(<span class="var type1" id="S47T3U392">maxIncomingLinks</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="mxinfo" id="T2:U167"><span class="var type1" id="S56T2U396">receivingFlow</span> = <span class="mxinfo" id="T2:U169">zeros(<span class="var type1" id="S49T3U399">maxOutgoingLinks</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"><span class="mxinfo" id="T45:U171"><span class="var type1" id="S57T45U403">sendingFlow</span> = <span class="mxinfo" id="T45:U173">zeros(<span class="var type1" id="S47T3U406">maxIncomingLinks</span>,<span class="var type1" id="S18T3U407">totDestinations</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"><span class="mxinfo" id="T45:U176"><span class="var type1" id="S58T45U410">temp_sendingFlow</span> = <span class="mxinfo" id="T45:U178">zeros(<span class="var type1" id="S47T3U413">maxIncomingLinks</span>,<span class="var type1" id="S18T3U414">totDestinations</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="mxinfo" id="T45:U181"><span class="var type1" id="S59T45U417">temp_receivingFlow</span> = <span class="mxinfo" id="T45:U183">zeros(<span class="var type1" id="S49T3U420">maxOutgoingLinks</span>,<span class="var type1" id="S18T3U421">totDestinations</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="mxinfo" id="T45:U186"><span class="var type1" id="S60T45U424">outgoingFlow</span> = <span class="mxinfo" id="T45:U188">zeros(<span class="var type1" id="S49T3U427">maxOutgoingLinks</span>,<span class="var type1" id="S18T3U428">totDestinations</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo" id="T5:U191"><span class="var type1" id="S61T5U431">origins_t</span> = <span class="mxinfo" id="T5:U193">union(<span class="var type1" id="S8T5U434">origins</span>,<span class="mxinfo" id="T5:U195"><span class="mxinfo" id="T2:U196">find(<span class="mxinfo" id="T17:U197"><span class="var type1" id="S30T2U439">nin</span>==<span class="mxinfo" id="T3:U199">0</span></span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo" id="T5:U200"><span class="var type1" id="S64T5U443">destinations_t</span> = <span class="mxinfo" id="T5:U202">union(<span class="var type1" id="S9T5U446">destinations</span>,<span class="mxinfo" id="T5:U204"><span class="mxinfo" id="T2:U205">find(<span class="mxinfo" id="T17:U206"><span class="var type1" id="S31T2U451">nout</span>==<span class="mxinfo" id="T3:U208">0</span></span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"><span class="mxinfo" id="T2:U209"><span class="var type1" id="S65T2U455">deltaChange</span> = <span class="mxinfo" id="T2:U211">zeros(<span class="var type1" id="S17T3U458">totNodes</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="mxinfo" id="T2:U213"><span class="var type1" id="S66T2U462">sortedNodes</span> = <span class="mxinfo" id="T2:U215">zeros(<span class="var type1" id="S17T3U465">totNodes</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="mxinfo" id="T45:U217"><span class="var type1" id="S67T45U469">turningFractions</span> = <span class="mxinfo" id="T45:U219">zeros(<span class="var type1" id="S47T3U472">maxIncomingLinks</span>,<span class="var type1" id="S49T3U473">maxOutgoingLinks</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"><span class="mxinfo" id="T45:U222"><span class="var type1" id="S68T45U476">turningFlows</span> = <span class="mxinfo" id="T45:U224">zeros(<span class="var type1" id="S47T3U479">maxIncomingLinks</span>,<span class="var type1" id="S49T3U480">maxOutgoingLinks</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="comment">%forward implicit scheme</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="comment">%go sequentially over each time step</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo" id="T3:U227"><span class="var type1" id="S69T3U483">mean_it_iltm</span> = <span class="mxinfo" id="T3:U229">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo" id="T3:U230"><span class="var type1" id="S70T3U487">max_it_iltm</span> = <span class="mxinfo" id="T3:U232">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo" id="T3:U233"><span class="var type1" id="S71T3U491">totNodes_updates</span> = <span class="mxinfo" id="T3:U235">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="comment">%recalculate the cumulatives for each node at time step t until</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="comment">%there are no more changes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S72T3U495">t</span>=<span class="mxinfo" id="T3:U237">2</span>:<span class="mxinfo" id="T3:U238"><span class="var type1" id="S12T3U499">totT</span>+<span class="mxinfo" id="T3:U240">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T7:U241">~<span class="mxinfo" id="T7:U242">any(<span class="mxinfo" id="T17:U243"><span class="var type1" id="S41T38U507">nodes2update</span>(:,<span class="var type1" id="S72T3U509">t</span>)</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">        <span class="keyword">continue</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">    <span class="comment">%initialization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">    <span class="comment">%all helper functions need to be initialized at run time only once</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">    <span class="mxinfo" id="T17:U246"><span class="var type1" id="S74T17U513">RF_down_cvn_bool</span> = <span class="mxinfo" id="T17:U248"><span class="mxinfo" id="T7:U249">true</span>(<span class="var type1" id="S15T3U516">totLinks</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">    <span class="mxinfo" id="T17:U251"><span class="var type1" id="S75T17U520">SF_up_cvn_bool</span> = <span class="mxinfo" id="T17:U253"><span class="mxinfo" id="T7:U254">true</span>(<span class="var type1" id="S15T3U523">totLinks</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">    <span class="comment">%ORIGIN NODES&lt;----------------------------------------------------------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">    <span class="comment">%update origin nodes if needed before other nodes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T7:U256">any(<span class="mxinfo" id="T17:U257"><span class="var type1" id="S41T38U530">nodes2update</span>(<span class="var type1" id="S8T5U531">origins</span>,<span class="var type1" id="S72T3U532">t</span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S76T3U535">n_index</span>=<span class="mxinfo" id="T3:U262">1</span>:<span class="mxinfo" id="T3:U263">length(<span class="var type1" id="S8T5U540">origins</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">            <span class="mxinfo" id="T3:U265"><span class="var type1" id="S77T3U543">n</span> = <span class="mxinfo" id="T3:U267"><span class="var type1" id="S8T5U545">origins</span>(<span class="var type1" id="S76T3U546">n_index</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T7:U270"><span class="var type1" id="S41T38U550">nodes2update</span>(<span class="var type1" id="S77T3U551">n</span>,<span class="var type1" id="S72T3U552">t</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">                <span class="mxinfo" id="T3:U274"><span class="var type1" id="S71T3U555">totNodes_updates</span>=<span class="mxinfo" id="T3:U276"><span class="var type1" id="S71T3U557">totNodes_updates</span>+<span class="mxinfo" id="T3:U278">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">                <span class="mxinfo" id="T5:U279"><span class="mxinfo" id="T5:U280"><span class="var type1" id="S53T2U562">outgoingLinks</span>(<span class="mxinfo" id="T3:U282">1</span>:<span class="mxinfo" id="T3:U283"><span class="var type1" id="S31T2U566">nout</span>(<span class="var type1" id="S77T3U567">n</span>)</span>)</span> = <span class="mxinfo" id="T5:U286"><span class="var type1" id="S29T2U569">outL</span>(<span class="mxinfo" id="T3:U288"><span class="var type1" id="S33T2U572">posOut</span>(<span class="var type1" id="S77T3U573">n</span>)</span>:(<span class="mxinfo" id="T3:U291"><span class="mxinfo" id="T3:U292"><span class="mxinfo" id="T3:U293"><span class="var type1" id="S33T2U578">posOut</span>(<span class="var type1" id="S77T3U579">n</span>)</span>+<span class="mxinfo" id="T3:U296"><span class="var type1" id="S31T2U581">nout</span>(<span class="var type1" id="S77T3U582">n</span>)</span></span>-<span class="mxinfo" id="T3:U299">1</span></span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S78T3U586">l_index</span>=<span class="mxinfo" id="T3:U301">1</span>:<span class="mxinfo" id="T3:U302"><span class="var type1" id="S31T2U590">nout</span>(<span class="var type1" id="S77T3U591">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">                    <span class="mxinfo" id="T3:U305"><span class="var type1" id="S79T3U594">l</span>=<span class="mxinfo" id="T3:U307"><span class="var type1" id="S53T2U596">outgoingLinks</span>(<span class="var type1" id="S78T3U597">l_index</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">                    <span class="mxinfo" id="T5:U310"><span class="mxinfo" id="T5:U311"><span class="var type1" id="S58T45U601">temp_sendingFlow</span>(<span class="mxinfo" id="T3:U313">1</span>,:)</span> = <span class="mxinfo" id="T5:U314"><span class="mxinfo" id="T5:U315"><span class="var type1" id="S2T44U606">cvn_up</span>(<span class="var type1" id="S79T3U607">l</span>,:,<span class="mxinfo" id="T3:U318"><span class="var type1" id="S72T3U610">t</span>-<span class="mxinfo" id="T3:U320">1</span></span>)</span> + <span class="mxinfo" id="T5:U321"><span class="mxinfo" id="T5:U322"><span class="mxinfo" id="T5:U323"><span class="var type1" id="S13T44U615">TF</span>(<span class="mxinfo" id="T3:U325"><span class="mxinfo" id="T3:U326"><span class="mxinfo" id="T3:U327"><span class="var type1" id="S37T2U619">posTF</span>(<span class="var type1" id="S77T3U620">n</span>)</span>+<span class="var type1" id="S78T3U621">l_index</span></span>-<span class="mxinfo" id="T3:U331">1</span></span>,:,<span class="mxinfo" id="T3:U332"><span class="var type1" id="S72T3U625">t</span>-<span class="mxinfo" id="T3:U334">1</span></span>)</span>.*<span class="mxinfo" id="T5:U335"><span class="var type1" id="S10T44U628">ODmatrix</span>(<span class="var type1" id="S76T3U629">n_index</span>,:,<span class="mxinfo" id="T3:U338"><span class="var type1" id="S72T3U632">t</span>-<span class="mxinfo" id="T3:U340">1</span></span>)</span></span>*<span class="var type1" id="S11T3U634">dt</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo" id="T7:U342"><span class="mxinfo" id="T3:U343">sum(<span class="mxinfo" id="T5:U344">abs(<span class="mxinfo" id="T5:U345"><span class="mxinfo" id="T5:U346"><span class="var type1" id="S58T45U644">temp_sendingFlow</span>(<span class="mxinfo" id="T3:U348">1</span>,:)</span>-<span class="mxinfo" id="T5:U349"><span class="var type1" id="S2T44U648">cvn_up</span>(<span class="var type1" id="S79T3U649">l</span>,:,<span class="var type1" id="S72T3U651">t</span>)</span></span>)</span>)</span>&gt;<span class="mxinfo" id="T3:U353"><span class="var type1" id="S45T3U652">precDNL</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">                        <span class="comment">%if an origin is updated the future grid-points</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">                        <span class="comment">%also need checking because solution is CVN</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">                        <span class="mxinfo" id="T7:U355"><span class="mxinfo" id="T7:U356"><span class="var type1" id="S41T38U656">nodes2update</span>(<span class="var type1" id="S77T3U657">n</span>,<span class="mxinfo" id="T3:U359">min(<span class="mxinfo" id="T3:U360"><span class="var type1" id="S12T3U661">totT</span>+<span class="mxinfo" id="T3:U362">1</span></span>,<span class="mxinfo" id="T3:U363"><span class="var type1" id="S72T3U664">t</span>+<span class="mxinfo" id="T3:U365">1</span></span>)</span>)</span> = <span class="mxinfo" id="T7:U366">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">                        <span class="mxinfo" id="T5:U367"><span class="mxinfo" id="T5:U368"><span class="var type1" id="S2T44U671">cvn_up</span>(<span class="var type1" id="S79T3U672">l</span>,:,<span class="var type1" id="S72T3U674">t</span>)</span>=<span class="mxinfo" id="T5:U372"><span class="var type1" id="S58T45U676">temp_sendingFlow</span>(<span class="mxinfo" id="T3:U374">1</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo" id="T7:U375"><span class="mxinfo" id="T3:U376"><span class="mxinfo" id="T3:U377">sum(<span class="mxinfo" id="T5:U378"><span class="var type1" id="S2T44U686">cvn_up</span>(<span class="var type1" id="S79T3U687">l</span>,:,<span class="var type1" id="S72T3U689">t</span>)</span>)</span>-<span class="mxinfo" id="T3:U382">sum(<span class="mxinfo" id="T5:U383"><span class="var type1" id="S2T44U693">cvn_up</span>(<span class="var type1" id="S79T3U694">l</span>,:,<span class="mxinfo" id="T3:U386"><span class="var type1" id="S72T3U697">t</span>-<span class="mxinfo" id="T3:U388">1</span></span>)</span>)</span></span> &lt; <span class="mxinfo" id="T3:U389"><span class="mxinfo" id="T3:U390"><span class="var type1" id="S22T2U701">cap</span>(<span class="var type1" id="S79T3U702">l</span>)</span>*<span class="var type1" id="S11T3U703">dt</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">                            <span class="mxinfo" id="T7:U394"><span class="mxinfo" id="T7:U395"><span class="var type1" id="S4T38U707">con_up</span>(<span class="mxinfo" id="T3:U397"><span class="var type1" id="S53T2U709">outgoingLinks</span>(<span class="var type1" id="S78T3U710">l_index</span>)</span>,<span class="var type1" id="S72T3U711">t</span>)</span>=<span class="mxinfo" id="T7:U401">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">                        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">                            <span class="mxinfo" id="T7:U402"><span class="mxinfo" id="T7:U403"><span class="var type1" id="S4T38U718">con_up</span>(<span class="mxinfo" id="T3:U405"><span class="var type1" id="S53T2U720">outgoingLinks</span>(<span class="var type1" id="S78T3U721">l_index</span>)</span>,<span class="var type1" id="S72T3U722">t</span>)</span>=<span class="mxinfo" id="T7:U409">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo" id="T7:U410"><span class="mxinfo" id="T3:U411"><span class="var type1" id="S24T2U729">vind</span>(<span class="var type1" id="S79T3U730">l</span>)</span>==<span class="mxinfo" id="T3:U414">-<span class="mxinfo" id="T3:U415">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">                            <span class="mxinfo" id="T7:U416"><span class="mxinfo" id="T7:U417"><span class="var type1" id="S41T38U736">nodes2update</span>(<span class="mxinfo" id="T3:U419"><span class="var type1" id="S20T2U738">endN</span>(<span class="var type1" id="S79T3U739">l</span>)</span>,<span class="var type1" id="S72T3U740">t</span>)</span>=<span class="mxinfo" id="T7:U423">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">                        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">                            <span class="mxinfo" id="T48:U424"><span class="mxinfo" id="T48:U425"><span class="var type1" id="S41T38U747">nodes2update</span>(<span class="mxinfo" id="T3:U427"><span class="var type1" id="S20T2U749">endN</span>(<span class="var type1" id="S79T3U750">l</span>)</span>,<span class="mxinfo" id="T5:U430">min(<span class="mxinfo" id="T3:U431"><span class="var type1" id="S12T3U754">totT</span>+<span class="mxinfo" id="T3:U433">1</span></span>,<span class="mxinfo" id="T5:U434"><span class="mxinfo" id="T3:U435"><span class="mxinfo" id="T3:U436"><span class="var type1" id="S72T3U759">t</span>-<span class="mxinfo" id="T3:U438"><span class="var type1" id="S24T2U761">vind</span>(<span class="var type1" id="S79T3U762">l</span>)</span></span>-<span class="mxinfo" id="T3:U441">1</span></span>:<span class="mxinfo" id="T3:U442"><span class="var type1" id="S72T3U765">t</span>-<span class="mxinfo" id="T3:U444"><span class="var type1" id="S24T2U767">vind</span>(<span class="var type1" id="S79T3U768">l</span>)</span></span></span>)</span>)</span>=<span class="mxinfo" id="T7:U447">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">    <span class="comment">%first iteration nodes are sorted in no specific order</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">    <span class="mxinfo" id="T3:U448"><span class="var type1" id="S83T3U773">n_i</span>=<span class="mxinfo" id="T3:U450">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S77T3U777">n</span>=<span class="mxinfo" id="T3:U452">1</span>:<span class="var type1" id="S17T3U780">totNodes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T7:U454"><span class="var type1" id="S41T38U786">nodes2update</span>(<span class="var type1" id="S77T3U787">n</span>,<span class="var type1" id="S72T3U788">t</span>)</span> &amp;&amp; <span class="mxinfo" id="T7:U458">~<span class="mxinfo" id="T7:U459">any(<span class="mxinfo" id="T48:U460"><span class="var type1" id="S77T3U793">n</span> == <span class="var type1" id="S61T5U794">origins_t</span></span>)</span></span> &amp;&amp; <span class="mxinfo" id="T7:U463">~<span class="mxinfo" id="T7:U464">any(<span class="mxinfo" id="T48:U465"><span class="var type1" id="S77T3U799">n</span> == <span class="var type1" id="S64T5U800">destinations_t</span></span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">            <span class="mxinfo" id="T3:U468"><span class="mxinfo" id="T3:U469"><span class="var type1" id="S66T2U804">sortedNodes</span>(<span class="var type1" id="S83T3U805">n_i</span>)</span> = <span class="var type1" id="S77T3U806">n</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">            <span class="mxinfo" id="T3:U473"><span class="var type1" id="S83T3U809">n_i</span>=<span class="mxinfo" id="T3:U475"><span class="var type1" id="S83T3U811">n_i</span>+<span class="mxinfo" id="T3:U477">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">    <span class="comment">%amount of nodes that still need updating</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">    <span class="mxinfo" id="T3:U478"><span class="var type1" id="S84T3U815">current_totNodes</span>=<span class="mxinfo" id="T3:U480"><span class="var type1" id="S83T3U817">n_i</span>-<span class="mxinfo" id="T3:U482">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line">    <span class="comment">% ACTUAL I-LTM ITERATIONS &lt;-------------------------------------------------------------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">    <span class="comment">%only on normal nodes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">    <span class="comment">%during iterations activate/deactivate nodes for updating based on</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">    <span class="comment">%dynamics until no more nodes need updating</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">    <span class="mxinfo" id="T3:U483"><span class="var type1" id="S85T3U821">it</span> = <span class="mxinfo" id="T3:U485">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">    <span class="keyword">while</span> <span class="mxinfo" id="T7:U486"><span class="var type1" id="S85T3U826">it</span>&lt;<span class="mxinfo" id="T3:U488"><span class="var type1" id="S43T3U827">max_it_ILTM</span></span></span> &amp;&amp; <span class="mxinfo" id="T7:U490"><span class="var type1" id="S84T3U829">current_totNodes</span>&gt;<span class="mxinfo" id="T3:U492">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">        <span class="comment">%as long as there are nodes to be updated do an iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">        <span class="mxinfo" id="T3:U493"><span class="var type1" id="S85T3U833">it</span> = <span class="mxinfo" id="T3:U495"><span class="var type1" id="S85T3U835">it</span> + <span class="mxinfo" id="T3:U497">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line">        <span class="comment">%total amount of node updates for the ILTM procedure</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line">        <span class="mxinfo" id="T3:U498"><span class="var type1" id="S71T3U839">totNodes_updates</span>=<span class="mxinfo" id="T3:U500"><span class="var type1" id="S71T3U841">totNodes_updates</span> + <span class="var type1" id="S84T3U842">current_totNodes</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line">        <span class="comment">%go over all ordered nodes that need updating</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S86T3U845">nIndex</span>=<span class="mxinfo" id="T3:U504">1</span>:<span class="var type1" id="S84T3U848">current_totNodes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line">            <span class="mxinfo" id="T3:U506"><span class="var type1" id="S77T3U851">n</span>=<span class="mxinfo" id="T3:U508"><span class="var type1" id="S66T2U853">sortedNodes</span>(<span class="var type1" id="S86T3U854">nIndex</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line">            <span class="mxinfo" id="T5:U511"><span class="mxinfo" id="T5:U512"><span class="var type1" id="S52T2U858">incomingLinks</span>(<span class="mxinfo" id="T3:U514">1</span>:<span class="mxinfo" id="T3:U515"><span class="var type1" id="S30T2U862">nin</span>(<span class="var type1" id="S77T3U863">n</span>)</span>)</span> = <span class="mxinfo" id="T5:U518"><span class="var type1" id="S28T2U865">inL</span>(<span class="mxinfo" id="T3:U520"><span class="var type1" id="S32T2U868">posIn</span>(<span class="var type1" id="S77T3U869">n</span>)</span>:(<span class="mxinfo" id="T3:U523"><span class="mxinfo" id="T3:U524"><span class="mxinfo" id="T3:U525"><span class="var type1" id="S32T2U874">posIn</span>(<span class="var type1" id="S77T3U875">n</span>)</span>+<span class="mxinfo" id="T3:U528"><span class="var type1" id="S30T2U877">nin</span>(<span class="var type1" id="S77T3U878">n</span>)</span></span>-<span class="mxinfo" id="T3:U531">1</span></span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line">            <span class="mxinfo" id="T5:U532"><span class="mxinfo" id="T5:U533"><span class="var type1" id="S53T2U883">outgoingLinks</span>(<span class="mxinfo" id="T3:U535">1</span>:<span class="mxinfo" id="T3:U536"><span class="var type1" id="S31T2U887">nout</span>(<span class="var type1" id="S77T3U888">n</span>)</span>)</span> = <span class="mxinfo" id="T5:U539"><span class="var type1" id="S29T2U890">outL</span>(<span class="mxinfo" id="T3:U541"><span class="var type1" id="S33T2U893">posOut</span>(<span class="var type1" id="S77T3U894">n</span>)</span>:(<span class="mxinfo" id="T3:U544"><span class="mxinfo" id="T3:U545"><span class="mxinfo" id="T3:U546"><span class="var type1" id="S33T2U899">posOut</span>(<span class="var type1" id="S77T3U900">n</span>)</span>+<span class="mxinfo" id="T3:U549"><span class="var type1" id="S31T2U902">nout</span>(<span class="var type1" id="S77T3U903">n</span>)</span></span>-<span class="mxinfo" id="T3:U552">1</span></span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line">            <span class="mxinfo" id="T3:U553"><span class="mxinfo" id="T3:U554"><span class="var type1" id="S65T2U908">deltaChange</span>(<span class="var type1" id="S77T3U909">n</span>)</span>=<span class="mxinfo" id="T3:U557">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line">            <span class="comment">%STANDARD NODES&lt;-----------------------------------------------------------------------------------------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line">            <span class="comment">%most function calls will end up here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line">            <span class="comment">%CALCULATE THE SENDING FLOW&lt;----------------------------------------------------------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">            <span class="comment">%this is the maximum number of vehicles comming from the incoming links that wants to travel over a node within this time interval</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">            <span class="comment">%multiple solution are possible</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">            <span class="comment">%so far only the simple triangular FD solution is implemented here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">            <span class="comment">%alternatives are a combined quadratic linear FD or</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">            <span class="comment">%hypocritical waiting because of intersections</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S78T3U913">l_index</span>=<span class="mxinfo" id="T3:U559">1</span>:<span class="mxinfo" id="T3:U560"><span class="var type1" id="S30T2U917">nin</span>(<span class="var type1" id="S77T3U918">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">                <span class="mxinfo" id="T3:U563"><span class="var type1" id="S79T3U921">l</span>=<span class="mxinfo" id="T3:U565"><span class="var type1" id="S52T2U923">incomingLinks</span>(<span class="var type1" id="S78T3U924">l_index</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">                <span class="comment">%initialize helper function if this is the first</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">                <span class="comment">%time the link is evaluated</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo" id="T7:U568"><span class="var type1" id="S75T17U928">SF_up_cvn_bool</span>(<span class="var type1" id="S79T3U929">l</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">                    <span class="mxinfo" id="T7:U571"><span class="mxinfo" id="T7:U572"><span class="var type1" id="S75T17U933">SF_up_cvn_bool</span>(<span class="var type1" id="S79T3U934">l</span>)</span> = <span class="mxinfo" id="T7:U575">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">                    <span class="mxinfo" id="T5:U576"><span class="mxinfo" id="T5:U577"><span class="var type1" id="S51T45U940">SF_up_cvn_db</span>(<span class="var type1" id="S79T3U941">l</span>,:)</span> = <span class="mxinfo" id="T5:U580"><span class="mxinfo" id="T5:U581"><span class="mxinfo" id="T5:U582"><span class="var type1" id="S2T44U946">cvn_up</span>(<span class="var type1" id="S79T3U947">l</span>,:,(<span class="mxinfo" id="T3:U585">max(<span class="mxinfo" id="T3:U586">1</span>,<span class="mxinfo" id="T3:U587"><span class="var type1" id="S72T3U954">t</span>+<span class="mxinfo" id="T3:U589"><span class="var type1" id="S24T2U956">vind</span>(<span class="var type1" id="S79T3U957">l</span>)</span></span>)</span>))</span>*(<span class="mxinfo" id="T3:U592"><span class="mxinfo" id="T3:U593">1</span>-<span class="mxinfo" id="T3:U594"><span class="var type1" id="S25T2U962">vRt</span>(<span class="var type1" id="S79T3U963">l</span>)</span></span>)</span> - <span class="mxinfo" id="T5:U597"><span class="var type1" id="S3T44U965">cvn_down</span>(<span class="var type1" id="S79T3U966">l</span>,:,<span class="mxinfo" id="T3:U600"><span class="var type1" id="S72T3U969">t</span>-<span class="mxinfo" id="T3:U602">1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo" id="T7:U603"><span class="mxinfo" id="T3:U604"><span class="var type1" id="S24T2U975">vind</span>(<span class="var type1" id="S79T3U976">l</span>)</span>&lt;<span class="mxinfo" id="T3:U607">-<span class="mxinfo" id="T3:U608">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line">                        <span class="mxinfo" id="T5:U609"><span class="mxinfo" id="T5:U610"><span class="var type1" id="S51T45U982">SF_up_cvn_db</span>(<span class="var type1" id="S79T3U983">l</span>,:)</span> = <span class="mxinfo" id="T5:U613"><span class="mxinfo" id="T5:U614"><span class="var type1" id="S51T45U987">SF_up_cvn_db</span>(<span class="var type1" id="S79T3U988">l</span>,:)</span>+<span class="mxinfo" id="T5:U617"><span class="mxinfo" id="T3:U618"><span class="var type1" id="S25T2U992">vRt</span>(<span class="var type1" id="S79T3U993">l</span>)</span>*<span class="mxinfo" id="T5:U621"><span class="var type1" id="S2T44U995">cvn_up</span>(<span class="var type1" id="S79T3U996">l</span>,:,<span class="mxinfo" id="T3:U624">max(<span class="mxinfo" id="T3:U625">1</span>,<span class="mxinfo" id="T3:U626"><span class="mxinfo" id="T3:U627"><span class="var type1" id="S72T3U1003">t</span>+<span class="mxinfo" id="T3:U629"><span class="var type1" id="S24T2U1005">vind</span>(<span class="var type1" id="S79T3U1006">l</span>)</span></span>+<span class="mxinfo" id="T3:U632">1</span></span>)</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line">                <span class="mxinfo" id="T5:U633"><span class="mxinfo" id="T5:U634"><span class="var type1" id="S57T45U1011">sendingFlow</span>(<span class="var type1" id="S78T3U1012">l_index</span>,:)</span>=<span class="mxinfo" id="T5:U637"><span class="var type1" id="S51T45U1015">SF_up_cvn_db</span>(<span class="var type1" id="S79T3U1016">l</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo" id="T7:U640"><span class="mxinfo" id="T3:U641"><span class="var type1" id="S24T2U1022">vind</span>(<span class="var type1" id="S79T3U1023">l</span>)</span>==<span class="mxinfo" id="T3:U644">-<span class="mxinfo" id="T3:U645">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line">                    <span class="mxinfo" id="T5:U646"><span class="mxinfo" id="T5:U647"><span class="var type1" id="S57T45U1029">sendingFlow</span>(<span class="var type1" id="S78T3U1030">l_index</span>,:)</span>=<span class="mxinfo" id="T5:U650"><span class="mxinfo" id="T5:U651"><span class="var type1" id="S57T45U1034">sendingFlow</span>(<span class="var type1" id="S78T3U1035">l_index</span>,:)</span>+<span class="mxinfo" id="T5:U654"><span class="mxinfo" id="T3:U655"><span class="var type1" id="S25T2U1039">vRt</span>(<span class="var type1" id="S79T3U1040">l</span>)</span>*<span class="mxinfo" id="T5:U658"><span class="var type1" id="S2T44U1042">cvn_up</span>(<span class="var type1" id="S79T3U1043">l</span>,:,<span class="var type1" id="S72T3U1045">t</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line">                <span class="mxinfo" id="T5:U662"><span class="mxinfo" id="T5:U663"><span class="var type1" id="S57T45U1049">sendingFlow</span>(<span class="var type1" id="S78T3U1050">l_index</span>,:)</span>=<span class="mxinfo" id="T5:U666">max(0,<span class="mxinfo" id="T5:U667"><span class="var type1" id="S57T45U1056">sendingFlow</span>(<span class="var type1" id="S78T3U1057">l_index</span>,:)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line">            <span class="comment">%CALCULATE RECEIVING FLOW&lt;------------------------------------------------------------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line">            <span class="comment">%this is the maximum number of vehicles that can flow into the outgoing links</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line">            <span class="comment">%gridlock is still possible in the end solution</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line">            <span class="comment">%in some cases it is better to switch to vertical</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line">            <span class="comment">%queues then by setting the jam density to infinity</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S78T3U1061">l_index</span>=<span class="mxinfo" id="T3:U671">1</span>:<span class="mxinfo" id="T3:U672"><span class="var type1" id="S31T2U1065">nout</span>(<span class="var type1" id="S77T3U1066">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line">                <span class="mxinfo" id="T3:U675"><span class="var type1" id="S79T3U1069">l</span>=<span class="mxinfo" id="T3:U677"><span class="var type1" id="S53T2U1071">outgoingLinks</span>(<span class="var type1" id="S78T3U1072">l_index</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line">                <span class="comment">%initialize helper function if this is the first</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line">                <span class="comment">%time the link is evaluated</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo" id="T7:U680"><span class="var type1" id="S74T17U1076">RF_down_cvn_bool</span>(<span class="var type1" id="S79T3U1077">l</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line">                    <span class="mxinfo" id="T7:U683"><span class="mxinfo" id="T7:U684"><span class="var type1" id="S74T17U1081">RF_down_cvn_bool</span>(<span class="var type1" id="S79T3U1082">l</span>)</span> = <span class="mxinfo" id="T7:U687">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line">                    <span class="mxinfo" id="T3:U688"><span class="mxinfo" id="T3:U689"><span class="var type1" id="S50T2U1088">RF_down_cvn_db</span>(<span class="var type1" id="S79T3U1089">l</span>)</span> = <span class="mxinfo" id="T3:U692"><span class="mxinfo" id="T3:U693"><span class="mxinfo" id="T3:U694"><span class="mxinfo" id="T3:U695">sum(<span class="mxinfo" id="T5:U696"><span class="var type1" id="S3T44U1096">cvn_down</span>(<span class="var type1" id="S79T3U1097">l</span>,:,<span class="mxinfo" id="T3:U699">max(<span class="mxinfo" id="T3:U700">1</span>,<span class="mxinfo" id="T3:U701"><span class="var type1" id="S72T3U1103">t</span>+<span class="mxinfo" id="T3:U703"><span class="var type1" id="S26T2U1105">wind</span>(<span class="var type1" id="S79T3U1106">l</span>)</span></span>)</span>)</span>)</span>.*(<span class="mxinfo" id="T3:U706"><span class="mxinfo" id="T3:U707">1</span>-<span class="mxinfo" id="T3:U708"><span class="var type1" id="S27T2U1111">wRt</span>(<span class="var type1" id="S79T3U1112">l</span>)</span></span>)</span> - <span class="mxinfo" id="T3:U711">sum(<span class="mxinfo" id="T5:U712"><span class="var type1" id="S2T44U1116">cvn_up</span>(<span class="var type1" id="S79T3U1117">l</span>,:,<span class="mxinfo" id="T3:U715"><span class="var type1" id="S72T3U1120">t</span>-<span class="mxinfo" id="T3:U717">1</span></span>)</span>)</span></span> + <span class="mxinfo" id="T3:U718"><span class="mxinfo" id="T3:U719"><span class="var type1" id="S23T2U1124">kJm</span>(<span class="var type1" id="S79T3U1125">l</span>)</span>*<span class="mxinfo" id="T3:U722"><span class="var type1" id="S21T2U1127">len</span>(<span class="var type1" id="S79T3U1128">l</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo" id="T7:U725"><span class="mxinfo" id="T3:U726"><span class="var type1" id="S26T2U1133">wind</span>(<span class="var type1" id="S79T3U1134">l</span>)</span>&lt;<span class="mxinfo" id="T3:U729">-<span class="mxinfo" id="T3:U730">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line">                        <span class="mxinfo" id="T3:U731"><span class="mxinfo" id="T3:U732"><span class="var type1" id="S50T2U1140">RF_down_cvn_db</span>(<span class="var type1" id="S79T3U1141">l</span>)</span>=<span class="mxinfo" id="T3:U735"><span class="mxinfo" id="T3:U736"><span class="var type1" id="S50T2U1144">RF_down_cvn_db</span>(<span class="var type1" id="S79T3U1145">l</span>)</span>+<span class="mxinfo" id="T3:U739"><span class="mxinfo" id="T3:U740"><span class="var type1" id="S27T2U1148">wRt</span>(<span class="var type1" id="S79T3U1149">l</span>)</span>*<span class="mxinfo" id="T3:U743">sum(<span class="mxinfo" id="T5:U744"><span class="var type1" id="S3T44U1153">cvn_down</span>(<span class="var type1" id="S79T3U1154">l</span>,:,<span class="mxinfo" id="T3:U747">max(<span class="mxinfo" id="T3:U748">1</span>,<span class="mxinfo" id="T3:U749"><span class="mxinfo" id="T3:U750"><span class="var type1" id="S72T3U1161">t</span>+<span class="mxinfo" id="T3:U752"><span class="var type1" id="S26T2U1163">wind</span>(<span class="var type1" id="S79T3U1164">l</span>)</span></span>+<span class="mxinfo" id="T3:U755">1</span></span>)</span>)</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line">                <span class="mxinfo" id="T3:U756"><span class="mxinfo" id="T3:U757"><span class="var type1" id="S56T2U1169">receivingFlow</span>(<span class="var type1" id="S78T3U1170">l_index</span>)</span>=<span class="mxinfo" id="T3:U760"><span class="var type1" id="S50T2U1172">RF_down_cvn_db</span>(<span class="var type1" id="S79T3U1173">l</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo" id="T7:U763"><span class="mxinfo" id="T3:U764"><span class="var type1" id="S26T2U1178">wind</span>(<span class="var type1" id="S79T3U1179">l</span>)</span>==<span class="mxinfo" id="T3:U767">-<span class="mxinfo" id="T3:U768">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line">                    <span class="mxinfo" id="T3:U769"><span class="mxinfo" id="T3:U770"><span class="var type1" id="S56T2U1185">receivingFlow</span>(<span class="var type1" id="S78T3U1186">l_index</span>)</span>=<span class="mxinfo" id="T3:U773"><span class="mxinfo" id="T3:U774"><span class="var type1" id="S56T2U1189">receivingFlow</span>(<span class="var type1" id="S78T3U1190">l_index</span>)</span>+<span class="mxinfo" id="T3:U777"><span class="mxinfo" id="T3:U778"><span class="var type1" id="S27T2U1193">wRt</span>(<span class="var type1" id="S79T3U1194">l</span>)</span>.*<span class="mxinfo" id="T3:U781">sum(<span class="mxinfo" id="T5:U782"><span class="var type1" id="S3T44U1198">cvn_down</span>(<span class="var type1" id="S79T3U1199">l</span>,:,<span class="var type1" id="S72T3U1201">t</span>)</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line">                <span class="mxinfo" id="T3:U786"><span class="mxinfo" id="T3:U787"><span class="var type1" id="S56T2U1205">receivingFlow</span>(<span class="var type1" id="S78T3U1206">l_index</span>)</span> = <span class="mxinfo" id="T3:U790">min(<span class="mxinfo" id="T3:U791"><span class="mxinfo" id="T3:U792"><span class="var type1" id="S22T2U1211">cap</span>(<span class="var type1" id="S79T3U1212">l</span>)</span>*<span class="var type1" id="S11T3U1213">dt</span></span>,<span class="mxinfo" id="T3:U796"><span class="var type1" id="S56T2U1215">receivingFlow</span>(<span class="var type1" id="S78T3U1216">l_index</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line">            <span class="comment">%CALCULATE TURNING FRACTIONS&lt;---------------------------------------------------------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line">            <span class="comment">%split rates of all flow that runs over the node</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T7:U799"><span class="mxinfo" id="T3:U800"><span class="var type1" id="S31T2U1221">nout</span>(<span class="var type1" id="S77T3U1222">n</span>)</span>==<span class="mxinfo" id="T3:U803">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line">                <span class="comment">%Straight forward merge</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line">                <span class="mxinfo" id="T2:U804"><span class="mxinfo" id="T2:U805"><span class="var type1" id="S67T45U1227">turningFractions</span>(<span class="mxinfo" id="T7:U807"><span class="mxinfo" id="T3:U808">1</span>:<span class="mxinfo" id="T3:U809"><span class="var type1" id="S30T2U1231">nin</span>(<span class="var type1" id="S77T3U1232">n</span>)</span></span>,<span class="mxinfo" id="T3:U812">1</span>)</span> = <span class="mxinfo" id="T3:U813">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line">                <span class="mxinfo" id="T5:U814"><span class="mxinfo" id="T5:U815"><span class="var type1" id="S60T45U1238">outgoingFlow</span>(<span class="mxinfo" id="T3:U817">1</span>,:)</span> = <span class="mxinfo" id="T3:U818">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line">                <span class="comment">%more complex nodes with multiple outgoing links</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line">                <span class="mxinfo" id="T3:U819"><span class="var type1" id="S87T3U1245">pl</span> = <span class="mxinfo" id="T3:U821"><span class="var type1" id="S37T2U1247">posTF</span>(<span class="var type1" id="S77T3U1248">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line">                <span class="mxinfo" id="T45:U824"><span class="var type1" id="S68T45U1252">turningFlows</span>(:)=<span class="mxinfo" id="T3:U826">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S88T3U1257">tf_ind</span>=<span class="mxinfo" id="T3:U828">1</span>:<span class="mxinfo" id="T3:U829"><span class="var type1" id="S34T2U1261">nTF</span>(<span class="var type1" id="S77T3U1262">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line">                    <span class="mxinfo" id="T3:U832"><span class="mxinfo" id="T3:U833"><span class="var type1" id="S68T45U1266">turningFlows</span>(<span class="mxinfo" id="T3:U835"><span class="var type1" id="S35T2U1268">inTF_index</span>(<span class="var type1" id="S87T3U1269">pl</span>)</span>,<span class="mxinfo" id="T3:U838"><span class="var type1" id="S36T2U1271">outTF_index</span>(<span class="var type1" id="S87T3U1272">pl</span>)</span>)</span>=<span class="mxinfo" id="T3:U841"><span class="mxinfo" id="T3:U842"><span class="var type1" id="S68T45U1275">turningFlows</span>(<span class="mxinfo" id="T3:U844"><span class="var type1" id="S35T2U1277">inTF_index</span>(<span class="var type1" id="S87T3U1278">pl</span>)</span>,<span class="mxinfo" id="T3:U847"><span class="var type1" id="S36T2U1280">outTF_index</span>(<span class="var type1" id="S87T3U1281">pl</span>)</span>)</span>+<span class="mxinfo" id="T3:U850">sum(<span class="mxinfo" id="T5:U851"><span class="mxinfo" id="T5:U852"><span class="var type1" id="S57T45U1286">sendingFlow</span>(<span class="mxinfo" id="T3:U854"><span class="var type1" id="S35T2U1288">inTF_index</span>(<span class="var type1" id="S87T3U1289">pl</span>)</span>,:)</span>.*<span class="mxinfo" id="T5:U857"><span class="var type1" id="S13T44U1292">TF</span>(<span class="var type1" id="S87T3U1293">pl</span>,:,<span class="mxinfo" id="T3:U860"><span class="var type1" id="S72T3U1296">t</span>-<span class="mxinfo" id="T3:U862">1</span></span>)</span></span>,2)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line">                    <span class="mxinfo" id="T3:U863"><span class="var type1" id="S87T3U1301">pl</span>=<span class="mxinfo" id="T3:U865"><span class="var type1" id="S87T3U1303">pl</span>+<span class="mxinfo" id="T3:U867">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line">                <span class="comment">%derive turning fractions from the turningFlows</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S78T3U1307">l_index</span>=<span class="mxinfo" id="T3:U869">1</span>:<span class="mxinfo" id="T3:U870"><span class="var type1" id="S30T2U1311">nin</span>(<span class="var type1" id="S77T3U1312">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line">                    <span class="mxinfo" id="T5:U873"><span class="mxinfo" id="T5:U874"><span class="var type1" id="S67T45U1316">turningFractions</span>(<span class="var type1" id="S78T3U1317">l_index</span>,<span class="mxinfo" id="T7:U877"><span class="mxinfo" id="T3:U878">1</span>:<span class="mxinfo" id="T3:U879"><span class="var type1" id="S31T2U1321">nout</span>(<span class="var type1" id="S77T3U1322">n</span>)</span></span>)</span> = <span class="mxinfo" id="T5:U882"><span class="mxinfo" id="T5:U883"><span class="var type1" id="S68T45U1325">turningFlows</span>(<span class="var type1" id="S78T3U1326">l_index</span>,<span class="mxinfo" id="T7:U886"><span class="mxinfo" id="T3:U887">1</span>:<span class="mxinfo" id="T3:U888"><span class="var type1" id="S31T2U1330">nout</span>(<span class="var type1" id="S77T3U1331">n</span>)</span></span>)</span>./<span class="mxinfo" id="T3:U891">sum(<span class="mxinfo" id="T5:U892"><span class="var type1" id="S68T45U1335">turningFlows</span>(<span class="var type1" id="S78T3U1336">l_index</span>,<span class="mxinfo" id="T7:U895"><span class="mxinfo" id="T3:U896">1</span>:<span class="mxinfo" id="T3:U897"><span class="var type1" id="S31T2U1340">nout</span>(<span class="var type1" id="S77T3U1341">n</span>)</span></span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line">                <span class="mxinfo" id="T2:U900"><span class="mxinfo" id="T2:U901"><span class="var type1" id="S67T45U1345">turningFractions</span>(<span class="mxinfo" id="T38:U903">isnan(<span class="var type1" id="S67T45U1348">turningFractions</span>)</span>)</span>=<span class="mxinfo" id="T3:U905">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,264" id="srcline264">264</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,265" id="srcline265">265</a></span><span class="line">            <span class="comment">%NODE MODEL&lt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,266" id="srcline266">266</a></span><span class="line">            <span class="comment">%warning: the script for node model is initialized with static</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,267" id="srcline267">267</a></span><span class="line">            <span class="comment">%fixed number of incoming or outgoing links</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,268" id="srcline268">268</a></span><span class="line">            <span class="comment">%be carefull if number of incoming or outgoing links is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,269" id="srcline269">269</a></span><span class="line">            <span class="comment">%bigger then 7</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,270" id="srcline270">270</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,271" id="srcline271">271</a></span><span class="line">            <span class="comment">%prepocessing input</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,272" id="srcline272">272</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S78T3U1352">l_index</span>=<span class="mxinfo" id="T3:U907">1</span>:<span class="mxinfo" id="T3:U908"><span class="var type1" id="S30T2U1356">nin</span>(<span class="var type1" id="S77T3U1357">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,273" id="srcline273">273</a></span><span class="line">                <span class="mxinfo" id="T3:U911"><span class="mxinfo" id="T3:U912"><span class="var type1" id="S54T2U1361">tot_sendingFlow</span>(<span class="var type1" id="S78T3U1362">l_index</span>)</span> = <span class="mxinfo" id="T3:U915">min(<span class="mxinfo" id="T3:U916">sum(<span class="mxinfo" id="T5:U917"><span class="var type1" id="S57T45U1368">sendingFlow</span>(<span class="var type1" id="S78T3U1369">l_index</span>,:)</span>)</span>,<span class="mxinfo" id="T3:U920"><span class="mxinfo" id="T3:U921"><span class="var type1" id="S22T2U1373">cap</span>(<span class="mxinfo" id="T3:U923"><span class="var type1" id="S52T2U1375">incomingLinks</span>(<span class="var type1" id="S78T3U1376">l_index</span>)</span>)</span>*<span class="var type1" id="S11T3U1377">dt</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,274" id="srcline274">274</a></span><span class="line">                <span class="mxinfo" id="T3:U927"><span class="mxinfo" id="T3:U928"><span class="var type1" id="S55T2U1381">temp_capacities</span>(<span class="var type1" id="S78T3U1382">l_index</span>)</span>=<span class="mxinfo" id="T3:U931"><span class="var type1" id="S22T2U1384">cap</span>(<span class="mxinfo" id="T3:U933"><span class="var type1" id="S52T2U1386">incomingLinks</span>(<span class="var type1" id="S78T3U1387">l_index</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,275" id="srcline275">275</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,276" id="srcline276">276</a></span><span class="line">            <span class="comment">%capacity proportional</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,277" id="srcline277">277</a></span><span class="line">            <span class="comment">%note that the node model can be further optimized to work faster</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,278" id="srcline278">278</a></span><span class="line">            <span class="comment">%might use the dynamic version (it is a bit slower though)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,279" id="srcline279">279</a></span><span class="line">            <span class="comment">%or copy model here and make it destination based (not hard)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,280" id="srcline280">280</a></span><span class="line">            <span class="mxinfo" id="T45:U936">[<span class="var type1" id="S90T45U1391">result_TurnFlow</span>] = <span class="mxinfo" id="T45:U938"><span class="fcn" id="F350N3:B1393">NodeModel</span>(<span class="mxinfo" id="T3:U939"><span class="var type1" id="S30T2U1395">nin</span>(<span class="var type1" id="S77T3U1396">n</span>)</span>,<span class="mxinfo" id="T3:U942"><span class="var type1" id="S31T2U1398">nout</span>(<span class="var type1" id="S77T3U1399">n</span>)</span>,<span class="mxinfo" id="T2:U945"><span class="var type1" id="S54T2U1401">tot_sendingFlow</span>(<span class="mxinfo" id="T3:U947">1</span>:<span class="mxinfo" id="T3:U948"><span class="var type1" id="S30T2U1405">nin</span>(<span class="var type1" id="S77T3U1406">n</span>)</span>)</span>,<span class="mxinfo" id="T45:U951"><span class="var type1" id="S67T45U1408">turningFractions</span>(<span class="mxinfo" id="T7:U953"><span class="mxinfo" id="T3:U954">1</span>:<span class="mxinfo" id="T3:U955"><span class="var type1" id="S30T2U1412">nin</span>(<span class="var type1" id="S77T3U1413">n</span>)</span></span>,<span class="mxinfo" id="T7:U958"><span class="mxinfo" id="T3:U959">1</span>:<span class="mxinfo" id="T3:U960"><span class="var type1" id="S31T2U1417">nout</span>(<span class="var type1" id="S77T3U1418">n</span>)</span></span>)</span>,<span class="mxinfo" id="T2:U963"><span class="var type1" id="S56T2U1420">receivingFlow</span>(<span class="mxinfo" id="T3:U965">1</span>:<span class="mxinfo" id="T3:U966"><span class="var type1" id="S31T2U1424">nout</span>(<span class="var type1" id="S77T3U1425">n</span>)</span>)</span>,<span class="mxinfo" id="T2:U969"><span class="var type1" id="S55T2U1427">temp_capacities</span>(<span class="mxinfo" id="T3:U971">1</span>:<span class="mxinfo" id="T3:U972"><span class="var type1" id="S30T2U1431">nin</span>(<span class="var type1" id="S77T3U1432">n</span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,281" id="srcline281">281</a></span><span class="line">            <span class="mxinfo" id="T2:U975"><span class="var type1" id="S92T2U1435">result_sendingFlow</span>=<span class="mxinfo" id="T2:U977">sum(<span class="var type1" id="S90T45U1438">result_TurnFlow</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,282" id="srcline282">282</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,283" id="srcline283">283</a></span><span class="line">            <span class="comment">%can be that turningFractions need to be adjusted because</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,284" id="srcline284">284</a></span><span class="line">            <span class="comment">%the sendingflow is less turning fractions might change a</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,285" id="srcline285">285</a></span><span class="line">            <span class="comment">%bit only with small update steps (over multiple time</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,286" id="srcline286">286</a></span><span class="line">            <span class="comment">%intervals linearization)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,287" id="srcline287">287</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,288" id="srcline288">288</a></span><span class="line">            <span class="comment">%TRANSFER FLOWS &amp;&amp; ACTIVATION OF NODES FOR NEXT ITERATION&lt;--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,289" id="srcline289">289</a></span><span class="line">            <span class="comment">%does the node need updating?</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,290" id="srcline290">290</a></span><span class="line">            <span class="mxinfo" id="T7:U979"><span class="var type1" id="S93T7U1442">act_bool</span> = <span class="mxinfo" id="T7:U981">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,291" id="srcline291">291</a></span><span class="line">            <span class="mxinfo" id="T45:U982"><span class="mxinfo" id="T45:U983"><span class="var type1" id="S59T45U1448">temp_receivingFlow</span>(<span class="mxinfo" id="T7:U985"><span class="mxinfo" id="T3:U986">1</span>:<span class="mxinfo" id="T3:U987"><span class="var type1" id="S31T2U1452">nout</span>(<span class="var type1" id="S77T3U1453">n</span>)</span></span>,:)</span> = <span class="mxinfo" id="T3:U990">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,292" id="srcline292">292</a></span><span class="line">            <span class="comment">%first handle the incoming links</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,293" id="srcline293">293</a></span><span class="line">            <span class="mxinfo" id="T3:U991"><span class="var type1" id="S94T3U1458">tf_index</span>=<span class="mxinfo" id="T3:U993"><span class="mxinfo" id="T3:U994"><span class="var type1" id="S37T2U1461">posTF</span>(<span class="var type1" id="S77T3U1462">n</span>)</span>-<span class="mxinfo" id="T3:U997">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,294" id="srcline294">294</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S78T3U1466">l_index</span>=<span class="mxinfo" id="T3:U999">1</span>:<span class="mxinfo" id="T3:U1000"><span class="var type1" id="S30T2U1470">nin</span>(<span class="var type1" id="S77T3U1471">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,295" id="srcline295">295</a></span><span class="line">                <span class="mxinfo" id="T3:U1003"><span class="var type1" id="S94T3U1474">tf_index</span>=<span class="mxinfo" id="T3:U1005"><span class="var type1" id="S94T3U1476">tf_index</span>+<span class="mxinfo" id="T3:U1007">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,296" id="srcline296">296</a></span><span class="line">                <span class="comment">%look for the active incoming links (links that send flow)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,297" id="srcline297">297</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo" id="T7:U1008">any(<span class="mxinfo" id="T48:U1009"><span class="mxinfo" id="T5:U1010"><span class="var type1" id="S57T45U1484">sendingFlow</span>(<span class="var type1" id="S78T3U1485">l_index</span>,:)</span>&gt;<span class="mxinfo" id="T3:U1013">0</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,298" id="srcline298">298</a></span><span class="line">                    <span class="comment">%check congestion</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,299" id="srcline299">299</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo" id="T7:U1014"><span class="mxinfo" id="T3:U1015"><span class="var type1" id="S92T2U1493">result_sendingFlow</span>(<span class="var type1" id="S78T3U1494">l_index</span>)</span> &lt; <span class="mxinfo" id="T3:U1018"><span class="var type1" id="S54T2U1496">tot_sendingFlow</span>(<span class="var type1" id="S78T3U1497">l_index</span>)</span></span> || <span class="mxinfo" id="T7:U1021"><span class="mxinfo" id="T3:U1022"><span class="var type1" id="S92T2U1500">result_sendingFlow</span>(<span class="var type1" id="S78T3U1501">l_index</span>)</span>==<span class="mxinfo" id="T3:U1025"><span class="mxinfo" id="T3:U1026"><span class="var type1" id="S55T2U1504">temp_capacities</span>(<span class="var type1" id="S78T3U1505">l_index</span>)</span>*<span class="var type1" id="S11T3U1506">dt</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,300" id="srcline300">300</a></span><span class="line">                        <span class="mxinfo" id="T7:U1030"><span class="mxinfo" id="T7:U1031"><span class="var type1" id="S5T38U1510">con_down</span>(<span class="mxinfo" id="T3:U1033"><span class="var type1" id="S52T2U1512">incomingLinks</span>(<span class="var type1" id="S78T3U1513">l_index</span>)</span>,<span class="var type1" id="S72T3U1514">t</span>)</span>=<span class="mxinfo" id="T7:U1037">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,301" id="srcline301">301</a></span><span class="line">                        <span class="comment">%find the sending flow for each destination</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,302" id="srcline302">302</a></span><span class="line">                        <span class="comment">%using FIFO rules distribution is proportional</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,303" id="srcline303">303</a></span><span class="line">                        <span class="mxinfo" id="T5:U1038"><span class="mxinfo" id="T5:U1039"><span class="var type1" id="S58T45U1520">temp_sendingFlow</span>(<span class="var type1" id="S78T3U1521">l_index</span>,:)</span>=<span class="mxinfo" id="T5:U1042"><span class="mxinfo" id="T5:U1043"><span class="mxinfo" id="T5:U1044"><span class="var type1" id="S57T45U1526">sendingFlow</span>(<span class="var type1" id="S78T3U1527">l_index</span>,:)</span>/<span class="mxinfo" id="T3:U1047">sum(<span class="mxinfo" id="T5:U1048"><span class="var type1" id="S57T45U1532">sendingFlow</span>(<span class="var type1" id="S78T3U1533">l_index</span>,:)</span>)</span></span>*<span class="mxinfo" id="T3:U1051"><span class="var type1" id="S92T2U1536">result_sendingFlow</span>(<span class="var type1" id="S78T3U1537">l_index</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,304" id="srcline304">304</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,305" id="srcline305">305</a></span><span class="line">                        <span class="mxinfo" id="T7:U1054"><span class="mxinfo" id="T7:U1055"><span class="var type1" id="S5T38U1542">con_down</span>(<span class="mxinfo" id="T3:U1057"><span class="var type1" id="S52T2U1544">incomingLinks</span>(<span class="var type1" id="S78T3U1545">l_index</span>)</span>,<span class="var type1" id="S72T3U1546">t</span>)</span>=<span class="mxinfo" id="T7:U1061">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,306" id="srcline306">306</a></span><span class="line">                        <span class="mxinfo" id="T5:U1062"><span class="mxinfo" id="T5:U1063"><span class="var type1" id="S58T45U1552">temp_sendingFlow</span>(<span class="var type1" id="S78T3U1553">l_index</span>,:)</span>=<span class="mxinfo" id="T5:U1066"><span class="var type1" id="S57T45U1556">sendingFlow</span>(<span class="var type1" id="S78T3U1557">l_index</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,307" id="srcline307">307</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,308" id="srcline308">308</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,309" id="srcline309">309</a></span><span class="line">                    <span class="comment">%find out if change to the node change is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,310" id="srcline310">310</a></span><span class="line">                    <span class="comment">%significant fot this incoming link</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,311" id="srcline311">311</a></span><span class="line">                    <span class="mxinfo" id="T7:U1069"><span class="var type1" id="S95T7U1561">act_l_bool</span> = <span class="mxinfo" id="T7:U1071"><span class="mxinfo" id="T3:U1072">sum(<span class="mxinfo" id="T5:U1073">abs(<span class="mxinfo" id="T5:U1074"><span class="mxinfo" id="T5:U1075"><span class="var type1" id="S3T44U1569">cvn_down</span>(<span class="mxinfo" id="T3:U1077"><span class="var type1" id="S52T2U1571">incomingLinks</span>(<span class="var type1" id="S78T3U1572">l_index</span>)</span>,:,<span class="var type1" id="S72T3U1574">t</span>)</span>-(<span class="mxinfo" id="T5:U1081"><span class="mxinfo" id="T5:U1082"><span class="var type1" id="S3T44U1578">cvn_down</span>(<span class="mxinfo" id="T3:U1084"><span class="var type1" id="S52T2U1580">incomingLinks</span>(<span class="var type1" id="S78T3U1581">l_index</span>)</span>,:,<span class="mxinfo" id="T3:U1087"><span class="var type1" id="S72T3U1584">t</span>-<span class="mxinfo" id="T3:U1089">1</span></span>)</span>+<span class="mxinfo" id="T5:U1090"><span class="var type1" id="S58T45U1587">temp_sendingFlow</span>(<span class="var type1" id="S78T3U1588">l_index</span>,:)</span></span>)</span>)</span>)</span>&gt;<span class="mxinfo" id="T3:U1093"><span class="var type1" id="S45T3U1590">precDNL</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,312" id="srcline312">312</a></span><span class="line">                    <span class="mxinfo" id="T7:U1095"><span class="var type1" id="S93T7U1593">act_bool</span> = <span class="mxinfo" id="T7:U1097"><span class="var type1" id="S93T7U1595">act_bool</span>|<span class="var type1" id="S95T7U1596">act_l_bool</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,313" id="srcline313">313</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,314" id="srcline314">314</a></span><span class="line">                    <span class="comment">%check if upstream moving change needs to be calculated</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,315" id="srcline315">315</a></span><span class="line">                    <span class="keyword">if</span> <span class="var type1" id="S95T7U1599">act_l_bool</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,316" id="srcline316">316</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo" id="T7:U1101"><span class="mxinfo" id="T3:U1102"><span class="var type1" id="S26T2U1604">wind</span>(<span class="mxinfo" id="T3:U1104"><span class="var type1" id="S52T2U1606">incomingLinks</span>(<span class="var type1" id="S78T3U1607">l_index</span>)</span>)</span>==<span class="mxinfo" id="T3:U1107">-<span class="mxinfo" id="T3:U1108">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,317" id="srcline317">317</a></span><span class="line">                            <span class="mxinfo" id="T7:U1109"><span class="mxinfo" id="T7:U1110"><span class="var type1" id="S41T38U1613">nodes2update</span>(<span class="mxinfo" id="T3:U1112"><span class="var type1" id="S19T2U1615">strN</span>(<span class="mxinfo" id="T3:U1114"><span class="var type1" id="S52T2U1617">incomingLinks</span>(<span class="var type1" id="S78T3U1618">l_index</span>)</span>)</span>,<span class="var type1" id="S72T3U1619">t</span>)</span>=<span class="mxinfo" id="T7:U1118">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,318" id="srcline318">318</a></span><span class="line">                            <span class="mxinfo" id="T3:U1119"><span class="mxinfo" id="T3:U1120"><span class="var type1" id="S65T2U1625">deltaChange</span>(<span class="mxinfo" id="T3:U1122"><span class="var type1" id="S19T2U1627">strN</span>(<span class="mxinfo" id="T3:U1124"><span class="var type1" id="S52T2U1629">incomingLinks</span>(<span class="var type1" id="S78T3U1630">l_index</span>)</span>)</span>)</span>=<span class="mxinfo" id="T3:U1127"><span class="mxinfo" id="T3:U1128"><span class="var type1" id="S65T2U1633">deltaChange</span>(<span class="mxinfo" id="T3:U1130"><span class="var type1" id="S19T2U1635">strN</span>(<span class="mxinfo" id="T3:U1132"><span class="var type1" id="S52T2U1637">incomingLinks</span>(<span class="var type1" id="S78T3U1638">l_index</span>)</span>)</span>)</span>+<span class="mxinfo" id="T3:U1135"><span class="mxinfo" id="T3:U1136"><span class="var type1" id="S27T2U1641">wRt</span>(<span class="mxinfo" id="T3:U1138"><span class="var type1" id="S52T2U1643">incomingLinks</span>(<span class="var type1" id="S78T3U1644">l_index</span>)</span>)</span>*<span class="mxinfo" id="T3:U1141">sum(<span class="mxinfo" id="T5:U1142">abs(<span class="mxinfo" id="T5:U1143"><span class="mxinfo" id="T5:U1144"><span class="var type1" id="S3T44U1651">cvn_down</span>(<span class="mxinfo" id="T3:U1146"><span class="var type1" id="S52T2U1653">incomingLinks</span>(<span class="var type1" id="S78T3U1654">l_index</span>)</span>,:,<span class="var type1" id="S72T3U1656">t</span>)</span>-(<span class="mxinfo" id="T5:U1150"><span class="mxinfo" id="T5:U1151"><span class="var type1" id="S3T44U1660">cvn_down</span>(<span class="mxinfo" id="T3:U1153"><span class="var type1" id="S52T2U1662">incomingLinks</span>(<span class="var type1" id="S78T3U1663">l_index</span>)</span>,:,<span class="mxinfo" id="T3:U1156"><span class="var type1" id="S72T3U1666">t</span>-<span class="mxinfo" id="T3:U1158">1</span></span>)</span>+<span class="mxinfo" id="T5:U1159"><span class="var type1" id="S58T45U1669">temp_sendingFlow</span>(<span class="var type1" id="S78T3U1670">l_index</span>,:)</span></span>)</span>)</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,319" id="srcline319">319</a></span><span class="line">                        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,320" id="srcline320">320</a></span><span class="line">                            <span class="mxinfo" id="T48:U1162"><span class="mxinfo" id="T48:U1163"><span class="var type1" id="S41T38U1676">nodes2update</span>(<span class="mxinfo" id="T3:U1165"><span class="var type1" id="S19T2U1678">strN</span>(<span class="mxinfo" id="T3:U1167"><span class="var type1" id="S52T2U1680">incomingLinks</span>(<span class="var type1" id="S78T3U1681">l_index</span>)</span>)</span>,<span class="mxinfo" id="T5:U1170">min(<span class="mxinfo" id="T3:U1171"><span class="var type1" id="S12T3U1685">totT</span>+<span class="mxinfo" id="T3:U1173">1</span></span>,<span class="mxinfo" id="T5:U1174"><span class="mxinfo" id="T3:U1175"><span class="mxinfo" id="T3:U1176"><span class="var type1" id="S72T3U1690">t</span>-<span class="mxinfo" id="T3:U1178"><span class="var type1" id="S26T2U1692">wind</span>(<span class="mxinfo" id="T3:U1180"><span class="var type1" id="S52T2U1694">incomingLinks</span>(<span class="var type1" id="S78T3U1695">l_index</span>)</span>)</span></span>-<span class="mxinfo" id="T3:U1183">1</span></span>:<span class="mxinfo" id="T3:U1184"><span class="var type1" id="S72T3U1698">t</span>-<span class="mxinfo" id="T3:U1186"><span class="var type1" id="S26T2U1700">wind</span>(<span class="mxinfo" id="T3:U1188"><span class="var type1" id="S52T2U1702">incomingLinks</span>(<span class="var type1" id="S78T3U1703">l_index</span>)</span>)</span></span></span>)</span>)</span> = <span class="mxinfo" id="T7:U1191">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,321" id="srcline321">321</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,322" id="srcline322">322</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line">                    <span class="mxinfo" id="T48:U1192"><span class="var type1" id="S96T48U1708">active_d</span> = <span class="mxinfo" id="T48:U1194"><span class="mxinfo" id="T5:U1195"><span class="var type1" id="S57T45U1711">sendingFlow</span>(<span class="var type1" id="S78T3U1712">l_index</span>,:)</span>&gt;<span class="mxinfo" id="T3:U1198">0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line">                    <span class="comment">%distribute them over the outgoing links</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo" id="T7:U1199"><span class="mxinfo" id="T3:U1200"><span class="var type1" id="S31T2U1719">nout</span>(<span class="var type1" id="S77T3U1720">n</span>)</span>==<span class="mxinfo" id="T3:U1203">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line">                        <span class="mxinfo" id="T5:U1204"><span class="mxinfo" id="T5:U1205"><span class="var type1" id="S59T45U1725">temp_receivingFlow</span>(<span class="mxinfo" id="T3:U1207">1</span>,<span class="var type1" id="S96T48U1727">active_d</span>)</span>=<span class="mxinfo" id="T5:U1209"><span class="mxinfo" id="T5:U1210"><span class="var type1" id="S59T45U1730">temp_receivingFlow</span>(<span class="mxinfo" id="T3:U1212">1</span>,<span class="var type1" id="S96T48U1732">active_d</span>)</span>+<span class="mxinfo" id="T5:U1214"><span class="var type1" id="S58T45U1734">temp_sendingFlow</span>(<span class="var type1" id="S78T3U1735">l_index</span>,<span class="var type1" id="S96T48U1736">active_d</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,329" id="srcline329">329</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,330" id="srcline330">330</a></span><span class="line">                        <span class="keyword">for</span> <span class="var type1" id="S97T3U1740">l_index2</span>=<span class="mxinfo" id="T3:U1219">1</span>:<span class="mxinfo" id="T3:U1220"><span class="var type1" id="S31T2U1744">nout</span>(<span class="var type1" id="S77T3U1745">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,331" id="srcline331">331</a></span><span class="line">                            <span class="mxinfo" id="T5:U1223"><span class="mxinfo" id="T5:U1224"><span class="var type1" id="S59T45U1749">temp_receivingFlow</span>(<span class="var type1" id="S97T3U1750">l_index2</span>,<span class="var type1" id="S96T48U1751">active_d</span>)</span>=<span class="mxinfo" id="T5:U1228"><span class="mxinfo" id="T5:U1229"><span class="var type1" id="S59T45U1754">temp_receivingFlow</span>(<span class="var type1" id="S97T3U1755">l_index2</span>,<span class="var type1" id="S96T48U1756">active_d</span>)</span>+<span class="mxinfo" id="T5:U1233"><span class="mxinfo" id="T5:U1234"><span class="var type1" id="S58T45U1759">temp_sendingFlow</span>(<span class="var type1" id="S78T3U1760">l_index</span>,<span class="var type1" id="S96T48U1761">active_d</span>)</span>.*<span class="mxinfo" id="T5:U1238"><span class="var type1" id="S13T44U1763">TF</span>(<span class="var type1" id="S94T3U1764">tf_index</span>,<span class="var type1" id="S96T48U1765">active_d</span>,<span class="mxinfo" id="T3:U1242"><span class="var type1" id="S72T3U1767">t</span>-<span class="mxinfo" id="T3:U1244">1</span></span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,332" id="srcline332">332</a></span><span class="line">                            <span class="mxinfo" id="T3:U1245"><span class="var type1" id="S94T3U1771">tf_index</span>=<span class="mxinfo" id="T3:U1247"><span class="var type1" id="S94T3U1773">tf_index</span>+<span class="mxinfo" id="T3:U1249">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,333" id="srcline333">333</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,334" id="srcline334">334</a></span><span class="line">                        <span class="mxinfo" id="T3:U1250"><span class="var type1" id="S94T3U1777">tf_index</span>=<span class="mxinfo" id="T3:U1252"><span class="var type1" id="S94T3U1779">tf_index</span>-<span class="mxinfo" id="T3:U1254">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,335" id="srcline335">335</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,336" id="srcline336">336</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,337" id="srcline337">337</a></span><span class="line">                    <span class="keyword">for</span> <span class="var type1" id="S97T3U1784">l_index2</span>=<span class="mxinfo" id="T3:U1256">2</span>:<span class="mxinfo" id="T3:U1257"><span class="var type1" id="S31T2U1788">nout</span>(<span class="var type1" id="S77T3U1789">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,338" id="srcline338">338</a></span><span class="line">                        <span class="mxinfo" id="T3:U1260"><span class="var type1" id="S94T3U1792">tf_index</span>=<span class="mxinfo" id="T3:U1262"><span class="var type1" id="S94T3U1794">tf_index</span>+<span class="mxinfo" id="T3:U1264">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,339" id="srcline339">339</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,340" id="srcline340">340</a></span><span class="line">                    <span class="comment">%no flow on this link</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,341" id="srcline341">341</a></span><span class="line">                    <span class="mxinfo" id="T5:U1265"><span class="mxinfo" id="T5:U1266"><span class="var type1" id="S58T45U1799">temp_sendingFlow</span>(<span class="var type1" id="S78T3U1800">l_index</span>,:)</span> = <span class="mxinfo" id="T3:U1269">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,342" id="srcline342">342</a></span><span class="line">                    <span class="mxinfo" id="T7:U1270"><span class="mxinfo" id="T7:U1271"><span class="var type1" id="S5T38U1806">con_down</span>(<span class="mxinfo" id="T3:U1273"><span class="var type1" id="S52T2U1808">incomingLinks</span>(<span class="var type1" id="S78T3U1809">l_index</span>)</span>,<span class="var type1" id="S72T3U1810">t</span>)</span>=<span class="mxinfo" id="T7:U1277">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,343" id="srcline343">343</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,344" id="srcline344">344</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,345" id="srcline345">345</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,346" id="srcline346">346</a></span><span class="line">            <span class="comment">%now check the outgoing links</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,347" id="srcline347">347</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S78T3U1815">l_index</span>=<span class="mxinfo" id="T3:U1279">1</span>:<span class="mxinfo" id="T3:U1280"><span class="var type1" id="S31T2U1819">nout</span>(<span class="var type1" id="S77T3U1820">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,348" id="srcline348">348</a></span><span class="line">                <span class="comment">%find destination with significant change</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,349" id="srcline349">349</a></span><span class="line">                <span class="comment">%then check for reactivation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,350" id="srcline350">350</a></span><span class="line">                <span class="mxinfo" id="T7:U1283"><span class="var type1" id="S95T7U1823">act_l_bool</span>=<span class="mxinfo" id="T7:U1285"><span class="mxinfo" id="T3:U1286">sum(<span class="mxinfo" id="T5:U1287">abs(<span class="mxinfo" id="T5:U1288"><span class="mxinfo" id="T5:U1289"><span class="var type1" id="S2T44U1831">cvn_up</span>(<span class="mxinfo" id="T3:U1291"><span class="var type1" id="S53T2U1833">outgoingLinks</span>(<span class="var type1" id="S78T3U1834">l_index</span>)</span>,:,<span class="var type1" id="S72T3U1836">t</span>)</span>-(<span class="mxinfo" id="T5:U1295"><span class="mxinfo" id="T5:U1296"><span class="var type1" id="S2T44U1840">cvn_up</span>(<span class="mxinfo" id="T3:U1298"><span class="var type1" id="S53T2U1842">outgoingLinks</span>(<span class="var type1" id="S78T3U1843">l_index</span>)</span>,:,<span class="mxinfo" id="T3:U1301"><span class="var type1" id="S72T3U1846">t</span>-<span class="mxinfo" id="T3:U1303">1</span></span>)</span>+<span class="mxinfo" id="T5:U1304"><span class="var type1" id="S59T45U1849">temp_receivingFlow</span>(<span class="var type1" id="S78T3U1850">l_index</span>,:)</span></span>)</span>)</span>)</span>&gt;<span class="mxinfo" id="T3:U1307"><span class="var type1" id="S45T3U1852">precDNL</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,351" id="srcline351">351</a></span><span class="line">                <span class="mxinfo" id="T7:U1309"><span class="var type1" id="S93T7U1855">act_bool</span> = <span class="mxinfo" id="T7:U1311"><span class="var type1" id="S93T7U1857">act_bool</span>|<span class="var type1" id="S95T7U1858">act_l_bool</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,352" id="srcline352">352</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,353" id="srcline353">353</a></span><span class="line">                <span class="comment">%check congestion</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,354" id="srcline354">354</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo" id="T7:U1314"><span class="mxinfo" id="T3:U1315">sum(<span class="mxinfo" id="T5:U1316"><span class="var type1" id="S59T45U1865">temp_receivingFlow</span>(<span class="var type1" id="S78T3U1866">l_index</span>,:)</span>)</span> &lt; <span class="mxinfo" id="T3:U1319"><span class="var type1" id="S56T2U1869">receivingFlow</span>(<span class="var type1" id="S78T3U1870">l_index</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,355" id="srcline355">355</a></span><span class="line">                    <span class="mxinfo" id="T7:U1322"><span class="mxinfo" id="T7:U1323"><span class="var type1" id="S4T38U1874">con_up</span>(<span class="mxinfo" id="T3:U1325"><span class="var type1" id="S53T2U1876">outgoingLinks</span>(<span class="var type1" id="S78T3U1877">l_index</span>)</span>,<span class="var type1" id="S72T3U1878">t</span>)</span>=<span class="mxinfo" id="T7:U1329">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,356" id="srcline356">356</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,357" id="srcline357">357</a></span><span class="line">                    <span class="mxinfo" id="T7:U1330"><span class="mxinfo" id="T7:U1331"><span class="var type1" id="S4T38U1885">con_up</span>(<span class="mxinfo" id="T3:U1333"><span class="var type1" id="S53T2U1887">outgoingLinks</span>(<span class="var type1" id="S78T3U1888">l_index</span>)</span>,<span class="var type1" id="S72T3U1889">t</span>)</span>=<span class="mxinfo" id="T7:U1337">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,358" id="srcline358">358</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,359" id="srcline359">359</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,360" id="srcline360">360</a></span><span class="line">                <span class="comment">%check if downstream moving change needs to be calculated</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,361" id="srcline361">361</a></span><span class="line">                <span class="keyword">if</span> <span class="var type1" id="S95T7U1894">act_l_bool</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,362" id="srcline362">362</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo" id="T7:U1339"><span class="mxinfo" id="T3:U1340"><span class="var type1" id="S24T2U1899">vind</span>(<span class="mxinfo" id="T3:U1342"><span class="var type1" id="S53T2U1901">outgoingLinks</span>(<span class="var type1" id="S78T3U1902">l_index</span>)</span>)</span>==<span class="mxinfo" id="T3:U1345">-<span class="mxinfo" id="T3:U1346">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,363" id="srcline363">363</a></span><span class="line">                        <span class="mxinfo" id="T7:U1347"><span class="mxinfo" id="T7:U1348"><span class="var type1" id="S41T38U1908">nodes2update</span>(<span class="mxinfo" id="T3:U1350"><span class="var type1" id="S20T2U1910">endN</span>(<span class="mxinfo" id="T3:U1352"><span class="var type1" id="S53T2U1912">outgoingLinks</span>(<span class="var type1" id="S78T3U1913">l_index</span>)</span>)</span>,<span class="var type1" id="S72T3U1914">t</span>)</span>=<span class="mxinfo" id="T7:U1356">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,364" id="srcline364">364</a></span><span class="line">                        <span class="mxinfo" id="T3:U1357"><span class="mxinfo" id="T3:U1358"><span class="var type1" id="S65T2U1920">deltaChange</span>(<span class="mxinfo" id="T3:U1360"><span class="var type1" id="S20T2U1922">endN</span>(<span class="mxinfo" id="T3:U1362"><span class="var type1" id="S53T2U1924">outgoingLinks</span>(<span class="var type1" id="S78T3U1925">l_index</span>)</span>)</span>)</span>=<span class="mxinfo" id="T3:U1365"><span class="mxinfo" id="T3:U1366"><span class="var type1" id="S65T2U1928">deltaChange</span>(<span class="mxinfo" id="T3:U1368"><span class="var type1" id="S20T2U1930">endN</span>(<span class="mxinfo" id="T3:U1370"><span class="var type1" id="S53T2U1932">outgoingLinks</span>(<span class="var type1" id="S78T3U1933">l_index</span>)</span>)</span>)</span>+<span class="mxinfo" id="T3:U1373"><span class="mxinfo" id="T3:U1374"><span class="var type1" id="S25T2U1936">vRt</span>(<span class="mxinfo" id="T3:U1376"><span class="var type1" id="S53T2U1938">outgoingLinks</span>(<span class="var type1" id="S78T3U1939">l_index</span>)</span>)</span>*<span class="mxinfo" id="T3:U1379">sum(<span class="mxinfo" id="T5:U1380">abs(<span class="mxinfo" id="T5:U1381"><span class="mxinfo" id="T5:U1382"><span class="var type1" id="S2T44U1946">cvn_up</span>(<span class="mxinfo" id="T3:U1384"><span class="var type1" id="S53T2U1948">outgoingLinks</span>(<span class="var type1" id="S78T3U1949">l_index</span>)</span>,:,<span class="var type1" id="S72T3U1951">t</span>)</span>-(<span class="mxinfo" id="T5:U1388"><span class="mxinfo" id="T5:U1389"><span class="var type1" id="S2T44U1955">cvn_up</span>(<span class="mxinfo" id="T3:U1391"><span class="var type1" id="S53T2U1957">outgoingLinks</span>(<span class="var type1" id="S78T3U1958">l_index</span>)</span>,:,<span class="mxinfo" id="T3:U1394"><span class="var type1" id="S72T3U1961">t</span>-<span class="mxinfo" id="T3:U1396">1</span></span>)</span>+<span class="mxinfo" id="T5:U1397"><span class="var type1" id="S59T45U1964">temp_receivingFlow</span>(<span class="var type1" id="S78T3U1965">l_index</span>,:)</span></span>)</span>)</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,365" id="srcline365">365</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,366" id="srcline366">366</a></span><span class="line">                        <span class="mxinfo" id="T48:U1400"><span class="mxinfo" id="T48:U1401"><span class="var type1" id="S41T38U1971">nodes2update</span>(<span class="mxinfo" id="T3:U1403"><span class="var type1" id="S20T2U1973">endN</span>(<span class="mxinfo" id="T3:U1405"><span class="var type1" id="S53T2U1975">outgoingLinks</span>(<span class="var type1" id="S78T3U1976">l_index</span>)</span>)</span>,<span class="mxinfo" id="T5:U1408">min(<span class="mxinfo" id="T3:U1409"><span class="var type1" id="S12T3U1980">totT</span>+<span class="mxinfo" id="T3:U1411">1</span></span>,<span class="mxinfo" id="T5:U1412"><span class="mxinfo" id="T3:U1413"><span class="mxinfo" id="T3:U1414"><span class="var type1" id="S72T3U1985">t</span>-<span class="mxinfo" id="T3:U1416"><span class="var type1" id="S24T2U1987">vind</span>(<span class="mxinfo" id="T3:U1418"><span class="var type1" id="S53T2U1989">outgoingLinks</span>(<span class="var type1" id="S78T3U1990">l_index</span>)</span>)</span></span>-<span class="mxinfo" id="T3:U1421">1</span></span>:<span class="mxinfo" id="T3:U1422"><span class="var type1" id="S72T3U1993">t</span>-<span class="mxinfo" id="T3:U1424"><span class="var type1" id="S24T2U1995">vind</span>(<span class="mxinfo" id="T3:U1426"><span class="var type1" id="S53T2U1997">outgoingLinks</span>(<span class="var type1" id="S78T3U1998">l_index</span>)</span>)</span></span></span>)</span>)</span>=<span class="mxinfo" id="T7:U1429">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,367" id="srcline367">367</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,368" id="srcline368">368</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,369" id="srcline369">369</a></span><span class="line">                    <span class="comment">%check for changed flat CVN (instantenous) only for</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,370" id="srcline370">370</a></span><span class="line">                    <span class="comment">%marginal updates needed</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,371" id="srcline371">371</a></span><span class="line">                    <span class="keyword">if</span> <span class="var type1" id="S44T7U2003">marg_comp</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,372" id="srcline372">372</a></span><span class="line">                        <span class="mxinfo" id="T48:U1431"><span class="var type1" id="S98T48U2006">pot_d</span>=<span class="mxinfo" id="T48:U1433"><span class="mxinfo" id="T5:U1434"><span class="var type1" id="S59T45U2009">temp_receivingFlow</span>(<span class="var type1" id="S78T3U2010">l_index</span>,:)</span>&lt;=<span class="mxinfo" id="T3:U1437"><span class="var type1" id="S45T3U2012">precDNL</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,373" id="srcline373">373</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo" id="T7:U1439">any(<span class="var type1" id="S98T48U2018">pot_d</span>)</span> &amp;&amp; <span class="mxinfo" id="T7:U1441"><span class="mxinfo" id="T3:U1442">sum(<span class="mxinfo" id="T5:U1443">abs(<span class="mxinfo" id="T5:U1444"><span class="mxinfo" id="T5:U1445"><span class="var type1" id="S2T44U2026">cvn_up</span>(<span class="mxinfo" id="T3:U1447"><span class="var type1" id="S53T2U2028">outgoingLinks</span>(<span class="var type1" id="S78T3U2029">l_index</span>)</span>,<span class="var type1" id="S98T48U2030">pot_d</span>,<span class="var type1" id="S72T3U2031">t</span>)</span>-(<span class="mxinfo" id="T5:U1452"><span class="mxinfo" id="T5:U1453"><span class="var type1" id="S2T44U2035">cvn_up</span>(<span class="mxinfo" id="T3:U1455"><span class="var type1" id="S53T2U2037">outgoingLinks</span>(<span class="var type1" id="S78T3U2038">l_index</span>)</span>,<span class="var type1" id="S98T48U2039">pot_d</span>,<span class="mxinfo" id="T3:U1459"><span class="var type1" id="S72T3U2041">t</span>-<span class="mxinfo" id="T3:U1461">1</span></span>)</span>+<span class="mxinfo" id="T5:U1462"><span class="var type1" id="S59T45U2044">temp_receivingFlow</span>(<span class="var type1" id="S78T3U2045">l_index</span>,<span class="var type1" id="S98T48U2046">pot_d</span>)</span></span>)</span>)</span>)</span>&gt;<span class="mxinfo" id="T3:U1466"><span class="var type1" id="S45T3U2047">precDNL</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,374" id="srcline374">374</a></span><span class="line">                            <span class="mxinfo" id="T48:U1468"><span class="mxinfo" id="T48:U1469"><span class="var type1" id="S41T38U2051">nodes2update</span>(<span class="mxinfo" id="T3:U1471"><span class="var type1" id="S20T2U2053">endN</span>(<span class="mxinfo" id="T3:U1473"><span class="var type1" id="S53T2U2055">outgoingLinks</span>(<span class="var type1" id="S78T3U2056">l_index</span>)</span>)</span>,<span class="mxinfo" id="T7:U1476"><span class="var type1" id="S72T3U2058">t</span>:<span class="mxinfo" id="T3:U1478">min(<span class="mxinfo" id="T3:U1479"><span class="var type1" id="S12T3U2062">totT</span>+<span class="mxinfo" id="T3:U1481">1</span></span>,<span class="mxinfo" id="T3:U1482"><span class="var type1" id="S72T3U2065">t</span>+<span class="mxinfo" id="T3:U1484">1</span></span>)</span></span>)</span>=<span class="mxinfo" id="T7:U1485">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,375" id="srcline375">375</a></span><span class="line">                            <span class="mxinfo" id="T3:U1486"><span class="mxinfo" id="T3:U1487"><span class="var type1" id="S65T2U2072">deltaChange</span>(<span class="mxinfo" id="T3:U1489"><span class="var type1" id="S20T2U2074">endN</span>(<span class="mxinfo" id="T3:U1491"><span class="var type1" id="S53T2U2076">outgoingLinks</span>(<span class="var type1" id="S78T3U2077">l_index</span>)</span>)</span>)</span>=<span class="mxinfo" id="T3:U1494"><span class="mxinfo" id="T3:U1495"><span class="var type1" id="S65T2U2080">deltaChange</span>(<span class="mxinfo" id="T3:U1497"><span class="var type1" id="S20T2U2082">endN</span>(<span class="mxinfo" id="T3:U1499"><span class="var type1" id="S53T2U2084">outgoingLinks</span>(<span class="var type1" id="S78T3U2085">l_index</span>)</span>)</span>)</span> - <span class="mxinfo" id="T3:U1502"><span class="mxinfo" id="T3:U1503"><span class="var type1" id="S11T3U2088">dt</span>*<span class="mxinfo" id="T3:U1505">1</span></span>/<span class="mxinfo" id="T3:U1506"><span class="var type1" id="S24T2U2091">vind</span>(<span class="mxinfo" id="T3:U1508"><span class="var type1" id="S53T2U2093">outgoingLinks</span>(<span class="var type1" id="S78T3U2094">l_index</span>)</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,376" id="srcline376">376</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,377" id="srcline377">377</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,378" id="srcline378">378</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,379" id="srcline379">379</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,380" id="srcline380">380</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,381" id="srcline381">381</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,382" id="srcline382">382</a></span><span class="line">            <span class="comment">%only update all CVN if there is a significant change</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,383" id="srcline383">383</a></span><span class="line">            <span class="comment">%on a node (nodes are always consistent because all CVN</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,384" id="srcline384">384</a></span><span class="line">            <span class="comment">%are updated)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,385" id="srcline385">385</a></span><span class="line">            <span class="keyword">if</span> <span class="var type1" id="S93T7U2097">act_bool</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,386" id="srcline386">386</a></span><span class="line">                <span class="mxinfo" id="T7:U1512"><span class="mxinfo" id="T7:U1513"><span class="var type1" id="S41T38U2101">nodes2update</span>(<span class="var type1" id="S77T3U2102">n</span>,<span class="mxinfo" id="T3:U1516">min(<span class="mxinfo" id="T3:U1517"><span class="var type1" id="S12T3U2106">totT</span>+<span class="mxinfo" id="T3:U1519">1</span></span>,<span class="mxinfo" id="T3:U1520"><span class="var type1" id="S72T3U2109">t</span>+<span class="mxinfo" id="T3:U1522">1</span></span>)</span>)</span>=<span class="mxinfo" id="T7:U1523">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,387" id="srcline387">387</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,388" id="srcline388">388</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S78T3U2115">l_index</span>=<span class="mxinfo" id="T3:U1525">1</span>:<span class="mxinfo" id="T3:U1526"><span class="var type1" id="S30T2U2119">nin</span>(<span class="var type1" id="S77T3U2120">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,389" id="srcline389">389</a></span><span class="line">                <span class="mxinfo" id="T5:U1529"><span class="mxinfo" id="T5:U1530"><span class="var type1" id="S3T44U2124">cvn_down</span>(<span class="mxinfo" id="T3:U1532"><span class="var type1" id="S52T2U2126">incomingLinks</span>(<span class="var type1" id="S78T3U2127">l_index</span>)</span>,:,<span class="var type1" id="S72T3U2129">t</span>)</span>=<span class="mxinfo" id="T5:U1536"><span class="mxinfo" id="T5:U1537"><span class="var type1" id="S3T44U2132">cvn_down</span>(<span class="mxinfo" id="T3:U1539"><span class="var type1" id="S52T2U2134">incomingLinks</span>(<span class="var type1" id="S78T3U2135">l_index</span>)</span>,:,<span class="mxinfo" id="T3:U1542"><span class="var type1" id="S72T3U2138">t</span>-<span class="mxinfo" id="T3:U1544">1</span></span>)</span>+<span class="mxinfo" id="T5:U1545"><span class="var type1" id="S58T45U2141">temp_sendingFlow</span>(<span class="var type1" id="S78T3U2142">l_index</span>,:)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,390" id="srcline390">390</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,391" id="srcline391">391</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S78T3U2146">l_index</span>=<span class="mxinfo" id="T3:U1549">1</span>:<span class="mxinfo" id="T3:U1550"><span class="var type1" id="S31T2U2150">nout</span>(<span class="var type1" id="S77T3U2151">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,392" id="srcline392">392</a></span><span class="line">                <span class="mxinfo" id="T5:U1553"><span class="mxinfo" id="T5:U1554"><span class="var type1" id="S2T44U2155">cvn_up</span>(<span class="mxinfo" id="T3:U1556"><span class="var type1" id="S53T2U2157">outgoingLinks</span>(<span class="var type1" id="S78T3U2158">l_index</span>)</span>,:,<span class="var type1" id="S72T3U2160">t</span>)</span>=<span class="mxinfo" id="T5:U1560"><span class="mxinfo" id="T5:U1561"><span class="var type1" id="S2T44U2163">cvn_up</span>(<span class="mxinfo" id="T3:U1563"><span class="var type1" id="S53T2U2165">outgoingLinks</span>(<span class="var type1" id="S78T3U2166">l_index</span>)</span>,:,<span class="mxinfo" id="T3:U1566"><span class="var type1" id="S72T3U2169">t</span>-<span class="mxinfo" id="T3:U1568">1</span></span>)</span>+<span class="mxinfo" id="T5:U1569"><span class="var type1" id="S59T45U2172">temp_receivingFlow</span>(<span class="var type1" id="S78T3U2173">l_index</span>,:)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,393" id="srcline393">393</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,394" id="srcline394">394</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,395" id="srcline395">395</a></span><span class="line">        <span class="mxinfo" id="T5:U1572"><span class="mxinfo" id="T5:U1573"><span class="var type1" id="S65T2U2178">deltaChange</span>(<span class="var type1" id="S61T5U2179">origins_t</span>)</span>=<span class="mxinfo" id="T3:U1576">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,396" id="srcline396">396</a></span><span class="line">        <span class="mxinfo" id="T5:U1577"><span class="mxinfo" id="T5:U1578"><span class="var type1" id="S65T2U2184">deltaChange</span>(<span class="var type1" id="S64T5U2185">destinations_t</span>)</span>=<span class="mxinfo" id="T3:U1581">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,397" id="srcline397">397</a></span><span class="line">        <span class="comment">%sort all changed nodes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,398" id="srcline398">398</a></span><span class="line">        <span class="mxinfo" id="T2:U1582">[<span class="mxinfo" id="T3:U1583"><span class="mxinfo" id="T2:U1584">~</span></span>,<span class="var type1" id="S66T2U2192">sortedNodes</span>(<span class="mxinfo" id="T3:U1586">1</span>:<span class="var type1" id="S17T3U2195">totNodes</span>)] = sort(<span class="mxinfo" id="T2:U1588"><span class="var type1" id="S65T2U2199">deltaChange</span>(<span class="mxinfo" id="T3:U1590">1</span>:<span class="var type1" id="S17T3U2202">totNodes</span>)</span>,1,<span class="string">'descend'</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,399" id="srcline399">399</a></span><span class="line">        <span class="comment">%total active nodes for next iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,400" id="srcline400">400</a></span><span class="line">        <span class="mxinfo" id="T3:U1592"><span class="var type1" id="S84T3U2207">current_totNodes</span>=<span class="mxinfo" id="T3:U1594">sum(<span class="mxinfo" id="T17:U1595"><span class="mxinfo" id="T2:U1596"><span class="var type1" id="S65T2U2212">deltaChange</span>(<span class="mxinfo" id="T3:U1598">1</span>:<span class="var type1" id="S17T3U2215">totNodes</span>)</span>&gt;<span class="mxinfo" id="T3:U1600"><span class="var type1" id="S45T3U2216">precDNL</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,401" id="srcline401">401</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,402" id="srcline402">402</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,403" id="srcline403">403</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,404" id="srcline404">404</a></span><span class="line">    <span class="comment">%DESTINATION NODES&lt;----------------------------------------------------------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,405" id="srcline405">405</a></span><span class="line">    <span class="comment">%are only updated if the upstream cumulative of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,406" id="srcline406">406</a></span><span class="line">    <span class="comment">%an incoming links is changed</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,407" id="srcline407">407</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T7:U1602">any(<span class="mxinfo" id="T17:U1603"><span class="var type1" id="S41T38U2222">nodes2update</span>(<span class="var type1" id="S9T5U2223">destinations</span>,<span class="var type1" id="S72T3U2224">t</span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,408" id="srcline408">408</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S76T3U2227">n_index</span>=<span class="mxinfo" id="T3:U1608">1</span>:<span class="mxinfo" id="T3:U1609">length(<span class="var type1" id="S9T5U2232">destinations</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,409" id="srcline409">409</a></span><span class="line">            <span class="mxinfo" id="T3:U1611"><span class="var type1" id="S77T3U2235">n</span> = <span class="mxinfo" id="T3:U1613"><span class="var type1" id="S9T5U2237">destinations</span>(<span class="var type1" id="S76T3U2238">n_index</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,410" id="srcline410">410</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T7:U1616"><span class="var type1" id="S41T38U2242">nodes2update</span>(<span class="var type1" id="S77T3U2243">n</span>,<span class="var type1" id="S72T3U2244">t</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,411" id="srcline411">411</a></span><span class="line">                <span class="mxinfo" id="T3:U1620"><span class="var type1" id="S71T3U2247">totNodes_updates</span>=<span class="mxinfo" id="T3:U1622"><span class="var type1" id="S71T3U2249">totNodes_updates</span>+<span class="mxinfo" id="T3:U1624">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,412" id="srcline412">412</a></span><span class="line">                <span class="mxinfo" id="T5:U1625"><span class="mxinfo" id="T5:U1626"><span class="var type1" id="S52T2U2254">incomingLinks</span>(<span class="mxinfo" id="T3:U1628">1</span>:<span class="mxinfo" id="T3:U1629"><span class="var type1" id="S30T2U2258">nin</span>(<span class="var type1" id="S77T3U2259">n</span>)</span>)</span> = <span class="mxinfo" id="T5:U1632"><span class="var type1" id="S28T2U2261">inL</span>(<span class="mxinfo" id="T3:U1634"><span class="var type1" id="S32T2U2264">posIn</span>(<span class="var type1" id="S77T3U2265">n</span>)</span>:(<span class="mxinfo" id="T3:U1637"><span class="mxinfo" id="T3:U1638"><span class="mxinfo" id="T3:U1639"><span class="var type1" id="S32T2U2270">posIn</span>(<span class="var type1" id="S77T3U2271">n</span>)</span>+<span class="mxinfo" id="T3:U1642"><span class="var type1" id="S30T2U2273">nin</span>(<span class="var type1" id="S77T3U2274">n</span>)</span></span>-<span class="mxinfo" id="T3:U1645">1</span></span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,413" id="srcline413">413</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S78T3U2278">l_index</span>=<span class="mxinfo" id="T3:U1647">1</span>:<span class="mxinfo" id="T3:U1648"><span class="var type1" id="S30T2U2282">nin</span>(<span class="var type1" id="S77T3U2283">n</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,414" id="srcline414">414</a></span><span class="line">                    <span class="mxinfo" id="T3:U1651"><span class="var type1" id="S79T3U2286">l</span>=<span class="mxinfo" id="T3:U1653"><span class="var type1" id="S52T2U2288">incomingLinks</span>(<span class="var type1" id="S78T3U2289">l_index</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,415" id="srcline415">415</a></span><span class="line">                    <span class="mxinfo" id="T3:U1656"><span class="mxinfo" id="T3:U1657"><span class="var type1" id="S50T2U2293">RF_down_cvn_db</span>(<span class="var type1" id="S79T3U2294">l</span>)</span>=<span class="mxinfo" id="T3:U1660">inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,416" id="srcline416">416</a></span><span class="line">                    <span class="comment">%note that concidered intervals are always based on</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,417" id="srcline417">417</a></span><span class="line">                    <span class="comment">%free flow travel time (destination is an infinit sink)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,418" id="srcline418">418</a></span><span class="line">                    <span class="comment">%IMPORTANT: this is a modelling assumption needs to be</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,419" id="srcline419">419</a></span><span class="line">                    <span class="comment">%taken into account when setting up a network</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,420" id="srcline420">420</a></span><span class="line">                    <span class="comment">%note that the cumulatives are found by looking</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,421" id="srcline421">421</a></span><span class="line">                    <span class="comment">%into the up_cvn_ob of the previous iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,422" id="srcline422">422</a></span><span class="line">                    <span class="comment">%CALCULATE SENDING FLOW BASED ON FREE FLOW SPEED</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,423" id="srcline423">423</a></span><span class="line">                    <span class="comment">%only n is needed this is the destination</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,424" id="srcline424">424</a></span><span class="line">                    <span class="comment">%if multiple d are found an error should be thrown</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,425" id="srcline425">425</a></span><span class="line">                    <span class="mxinfo" id="T5:U1661"><span class="mxinfo" id="T5:U1662"><span class="var type1" id="S58T45U2300">temp_sendingFlow</span>(<span class="mxinfo" id="T3:U1664">1</span>,:)</span>=<span class="mxinfo" id="T5:U1665"><span class="mxinfo" id="T5:U1666">(<span class="mxinfo" id="T3:U1667"><span class="mxinfo" id="T3:U1668">1</span>-<span class="mxinfo" id="T3:U1669"><span class="var type1" id="S25T2U2309">vRt</span>(<span class="var type1" id="S79T3U2310">l</span>)</span></span>)*<span class="mxinfo" id="T5:U1672"><span class="var type1" id="S2T44U2312">cvn_up</span>(<span class="var type1" id="S79T3U2313">l</span>,:,<span class="mxinfo" id="T3:U1675">max(<span class="mxinfo" id="T3:U1676">1</span>,<span class="mxinfo" id="T3:U1677"><span class="var type1" id="S72T3U2319">t</span>+<span class="mxinfo" id="T3:U1679"><span class="var type1" id="S24T2U2321">vind</span>(<span class="var type1" id="S79T3U2322">l</span>)</span></span>)</span>)</span></span> + <span class="mxinfo" id="T5:U1682"><span class="mxinfo" id="T3:U1683"><span class="var type1" id="S25T2U2325">vRt</span>(<span class="var type1" id="S79T3U2326">l</span>)</span>*<span class="mxinfo" id="T5:U1686"><span class="var type1" id="S2T44U2328">cvn_up</span>(<span class="var type1" id="S79T3U2329">l</span>,:,<span class="mxinfo" id="T3:U1689">max(<span class="mxinfo" id="T3:U1690">1</span>,<span class="mxinfo" id="T3:U1691"><span class="mxinfo" id="T3:U1692"><span class="var type1" id="S72T3U2336">t</span>+<span class="mxinfo" id="T3:U1694"><span class="var type1" id="S24T2U2338">vind</span>(<span class="var type1" id="S79T3U2339">l</span>)</span></span>+<span class="mxinfo" id="T3:U1697">1</span></span>)</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,426" id="srcline426">426</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo" id="T7:U1698"><span class="mxinfo" id="T3:U1699">sum(<span class="mxinfo" id="T5:U1700">abs(<span class="mxinfo" id="T5:U1701"><span class="mxinfo" id="T5:U1702"><span class="var type1" id="S58T45U2350">temp_sendingFlow</span>(<span class="mxinfo" id="T3:U1704">1</span>,:)</span>-<span class="mxinfo" id="T5:U1705"><span class="var type1" id="S3T44U2354">cvn_down</span>(<span class="var type1" id="S79T3U2355">l</span>,:,<span class="var type1" id="S72T3U2357">t</span>)</span></span>)</span>)</span>&gt;<span class="mxinfo" id="T3:U1709"><span class="var type1" id="S45T3U2358">precDNL</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,427" id="srcline427">427</a></span><span class="line">                        <span class="mxinfo" id="T5:U1711"><span class="mxinfo" id="T5:U1712"><span class="var type1" id="S3T44U2362">cvn_down</span>(<span class="var type1" id="S79T3U2363">l</span>,:,<span class="var type1" id="S72T3U2365">t</span>)</span>=<span class="mxinfo" id="T5:U1716"><span class="var type1" id="S58T45U2367">temp_sendingFlow</span>(<span class="mxinfo" id="T3:U1718">1</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,428" id="srcline428">428</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,429" id="srcline429">429</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,430" id="srcline430">430</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,431" id="srcline431">431</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,432" id="srcline432">432</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,433" id="srcline433">433</a></span><span class="line">    <span class="mxinfo" id="T3:U1719"><span class="var type1" id="S69T3U2372">mean_it_iltm</span> = <span class="mxinfo" id="T3:U1721"><span class="var type1" id="S69T3U2374">mean_it_iltm</span> + <span class="mxinfo" id="T3:U1723">max(<span class="mxinfo" id="T3:U1724">1</span>,<span class="var type1" id="S85T3U2378">it</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,434" id="srcline434">434</a></span><span class="line">    <span class="mxinfo" id="T3:U1726"><span class="var type1" id="S70T3U2381">max_it_iltm</span> = <span class="mxinfo" id="T3:U1728">max(<span class="var type1" id="S70T3U2384">max_it_iltm</span>,<span class="var type1" id="S85T3U2385">it</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,435" id="srcline435">435</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,436" id="srcline436">436</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,437" id="srcline437">437</a></span><span class="line"><span class="comment">% display(['average number of iterations: ',num2str(mean_it_iltm/totT)]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,438" id="srcline438">438</a></span><span class="line"><span class="comment">% display(['maximum number of iterations: ',num2str(max_it_iltm)]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,439" id="srcline439">439</a></span><span class="line"><span class="comment">% display(['total number of node updates: ',num2str(totNodes_updates)]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,440" id="srcline440">440</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,441" id="srcline441">441</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,442" id="srcline442">442</a></span><span class="line"></span></span>
</pre>
